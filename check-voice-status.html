<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³åŠŸèƒ½çŠ¶æ€æ£€æµ‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            background: #f9fafb;
        }
        .status-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-label {
            font-weight: 500;
            color: #374151;
        }
        .status-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-ok {
            color: #059669;
        }
        .status-error {
            color: #dc2626;
        }
        .status-warning {
            color: #d97706;
        }
        .btn {
            width: 100%;
            padding: 14px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin: 10px 0;
        }
        .btn:active {
            background: #4f46e5;
        }
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        h1 {
            color: #111827;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #6b7280;
            margin-bottom: 20px;
        }
        .recommendation {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .recommendation-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 8px;
        }
        .recommendation-text {
            color: #1e40af;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤ è¯­éŸ³åŠŸèƒ½çŠ¶æ€æ£€æµ‹</h1>
    <p class="subtitle">æ£€æµ‹æ‚¨çš„è®¾å¤‡æ˜¯å¦æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½</p>

    <div class="status-card">
        <h3>ç³»ç»Ÿæ£€æµ‹</h3>
        <div class="status-item">
            <span class="status-label">æµè§ˆå™¨æ”¯æŒ</span>
            <span class="status-value" id="browserSupport">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="status-item">
            <span class="status-label">éº¦å…‹é£API</span>
            <span class="status-value" id="micSupport">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="status-item">
            <span class="status-label">ç½‘ç»œè¿æ¥</span>
            <span class="status-value" id="networkStatus">æ£€æµ‹ä¸­...</span>
        </div>
        <div class="status-item">
            <span class="status-label">GoogleæœåŠ¡</span>
            <span class="status-value" id="googleStatus">æ£€æµ‹ä¸­...</span>
        </div>
    </div>

    <div class="status-card">
        <h3>æƒé™çŠ¶æ€</h3>
        <div class="status-item">
            <span class="status-label">éº¦å…‹é£æƒé™</span>
            <span class="status-value" id="micPermission">æœªæ£€æµ‹</span>
        </div>
    </div>

    <div id="recommendation"></div>

    <button class="btn" onclick="checkPermission()">æ£€æµ‹éº¦å…‹é£æƒé™</button>
    <button class="btn" onclick="testVoice()" id="testBtn" disabled>æµ‹è¯•è¯­éŸ³è¯†åˆ«</button>

    <script>
        let canUseVoice = false;

        // æ£€æµ‹æµè§ˆå™¨æ”¯æŒ
        function checkBrowserSupport() {
            const hasSpeech = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
            const elem = document.getElementById('browserSupport');
            if (hasSpeech) {
                elem.innerHTML = '<span class="status-ok">âœ… æ”¯æŒ</span>';
                return true;
            } else {
                elem.innerHTML = '<span class="status-error">âŒ ä¸æ”¯æŒ</span>';
                return false;
            }
        }

        // æ£€æµ‹éº¦å…‹é£API
        function checkMicSupport() {
            const hasMic = 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;
            const elem = document.getElementById('micSupport');
            if (hasMic) {
                elem.innerHTML = '<span class="status-ok">âœ… æ”¯æŒ</span>';
                return true;
            } else {
                elem.innerHTML = '<span class="status-error">âŒ ä¸æ”¯æŒ</span>';
                return false;
            }
        }

        // æ£€æµ‹ç½‘ç»œè¿æ¥
        function checkNetwork() {
            const elem = document.getElementById('networkStatus');
            if (navigator.onLine) {
                elem.innerHTML = '<span class="status-ok">âœ… å·²è¿æ¥</span>';
                return true;
            } else {
                elem.innerHTML = '<span class="status-error">âŒ æœªè¿æ¥</span>';
                return false;
            }
        }

        // æ£€æµ‹GoogleæœåŠ¡
        async function checkGoogleService() {
            const elem = document.getElementById('googleStatus');
            elem.innerHTML = '<span class="status-warning">â³ æ£€æµ‹ä¸­...</span>';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                const response = await fetch('https://www.google.com/favicon.ico', {
                    mode: 'no-cors',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                elem.innerHTML = '<span class="status-ok">âœ… å¯è®¿é—®</span>';
                return true;
            } catch (error) {
                elem.innerHTML = '<span class="status-error">âŒ æ— æ³•è®¿é—®</span>';
                return false;
            }
        }

        // æ£€æµ‹éº¦å…‹é£æƒé™
        async function checkPermission() {
            const elem = document.getElementById('micPermission');
            elem.innerHTML = '<span class="status-warning">â³ è¯·æ±‚ä¸­...</span>';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                elem.innerHTML = '<span class="status-ok">âœ… å·²æˆæƒ</span>';
                document.getElementById('testBtn').disabled = false;
                return true;
            } catch (error) {
                elem.innerHTML = '<span class="status-error">âŒ è¢«æ‹’ç»</span>';
                return false;
            }
        }

        // æ˜¾ç¤ºå»ºè®®
        function showRecommendation(browserOk, micOk, networkOk, googleOk) {
            const recDiv = document.getElementById('recommendation');

            if (browserOk && micOk && networkOk && googleOk) {
                recDiv.innerHTML = `
                    <div class="recommendation">
                        <div class="recommendation-title">âœ… å¯ä»¥ä½¿ç”¨è¯­éŸ³è¾“å…¥</div>
                        <div class="recommendation-text">æ‚¨çš„è®¾å¤‡å®Œå…¨æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼Œç‚¹å‡»"æµ‹è¯•è¯­éŸ³è¯†åˆ«"å¼€å§‹æµ‹è¯•ã€‚</div>
                    </div>
                `;
                canUseVoice = true;
            } else if (!googleOk) {
                recDiv.innerHTML = `
                    <div class="recommendation">
                        <div class="recommendation-title">âš ï¸ æ— æ³•è®¿é—®GoogleæœåŠ¡</div>
                        <div class="recommendation-text">
                            è¯­éŸ³è¯†åˆ«éœ€è¦è¿æ¥GoogleæœåŠ¡å™¨ã€‚<br><br>
                            <strong>å»ºè®®ï¼š</strong><br>
                            1. ä½¿ç”¨VPNè¿æ¥åˆ°æµ·å¤–ç½‘ç»œ<br>
                            2. æˆ–åˆ‡æ¢åˆ°æ–‡å­—è¾“å…¥æ¨¡å¼<br>
                            3. æˆ–ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„è¯­éŸ³è¾“å…¥
                        </div>
                    </div>
                `;
            } else if (!networkOk) {
                recDiv.innerHTML = `
                    <div class="recommendation">
                        <div class="recommendation-title">âŒ ç½‘ç»œæœªè¿æ¥</div>
                        <div class="recommendation-text">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚</div>
                    </div>
                `;
            } else if (!browserOk) {
                recDiv.innerHTML = `
                    <div class="recommendation">
                        <div class="recommendation-title">âŒ æµè§ˆå™¨ä¸æ”¯æŒ</div>
                        <div class="recommendation-text">è¯·ä½¿ç”¨ Chromeã€Edge æˆ– Safari æµè§ˆå™¨ã€‚</div>
                    </div>
                `;
            } else if (!micOk) {
                recDiv.innerHTML = `
                    <div class="recommendation">
                        <div class="recommendation-title">âŒ éº¦å…‹é£APIä¸å¯ç”¨</div>
                        <div class="recommendation-text">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéº¦å…‹é£è®¿é—®ã€‚</div>
                    </div>
                `;
            }
        }

        // æµ‹è¯•è¯­éŸ³è¯†åˆ«
        function testVoice() {
            if (!canUseVoice) {
                alert('âŒ å½“å‰ç¯å¢ƒä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.lang = 'zh-CN';

            recognition.onstart = () => {
                alert('ğŸ¤ å¼€å§‹å½•éŸ³ï¼Œè¯·è¯´è¯...');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                alert('âœ… è¯†åˆ«æˆåŠŸï¼\n\nè¯†åˆ«ç»“æœï¼š' + transcript);
            };

            recognition.onerror = (event) => {
                alert('âŒ è¯†åˆ«å¤±è´¥\n\né”™è¯¯ï¼š' + event.error);
            };

            recognition.start();
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ£€æµ‹
        window.addEventListener('load', async () => {
            const browserOk = checkBrowserSupport();
            const micOk = checkMicSupport();
            const networkOk = checkNetwork();
            const googleOk = await checkGoogleService();

            showRecommendation(browserOk, micOk, networkOk, googleOk);
        });

        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', () => {
            checkNetwork();
            checkGoogleService();
        });

        window.addEventListener('offline', () => {
            checkNetwork();
        });
    </script>
</body>
</html>
