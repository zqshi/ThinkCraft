<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç« èŠ‚é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        h2 {
            color: #6366f1;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 10px;
        }
        h3 {
            color: #666;
            margin-top: 20px;
        }
        .chapter {
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-left: 3px solid #6366f1;
            border-radius: 4px;
        }
        .chapter-title {
            font-weight: 600;
            color: #333;
        }
        .chapter-desc {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }
        .chapter-id {
            font-size: 12px;
            color: #999;
            font-family: monospace;
        }
        .core {
            border-left-color: #10b981;
        }
        .optional {
            border-left-color: #f59e0b;
        }
        .stats {
            background: #eff6ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .stats-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        .stats-label {
            color: #666;
        }
        .stats-value {
            font-weight: 600;
            color: #6366f1;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç« èŠ‚é…ç½®å¯¹æ¯”æµ‹è¯•</h1>

    <div class="container">
        <!-- å•†ä¸šè®¡åˆ’ä¹¦ -->
        <div class="section">
            <h2>å•†ä¸šè®¡åˆ’ä¹¦ (Business Plan)</h2>

            <h3>æ ¸å¿ƒç« èŠ‚ï¼ˆå¿…é€‰ï¼‰</h3>
            <div id="business-core"></div>

            <h3>æ·±åº¦åˆ†æç« èŠ‚ï¼ˆå¯é€‰ï¼‰</h3>
            <div id="business-optional"></div>

            <div class="stats">
                <div class="stats-item">
                    <span class="stats-label">æ ¸å¿ƒç« èŠ‚æ•°ï¼š</span>
                    <span class="stats-value" id="business-core-count">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å¯é€‰ç« èŠ‚æ•°ï¼š</span>
                    <span class="stats-value" id="business-optional-count">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">æ€»ç« èŠ‚æ•°ï¼š</span>
                    <span class="stats-value" id="business-total-count">0</span>
                </div>
            </div>
        </div>

        <!-- äº§å“ç«‹é¡¹ææ–™ -->
        <div class="section">
            <h2>äº§å“ç«‹é¡¹ææ–™ (Proposal)</h2>

            <h3>æ ¸å¿ƒç« èŠ‚ï¼ˆå¿…é€‰ï¼‰</h3>
            <div id="proposal-core"></div>

            <h3>æ·±åº¦åˆ†æç« èŠ‚ï¼ˆå¯é€‰ï¼‰</h3>
            <div id="proposal-optional"></div>

            <div class="stats">
                <div class="stats-item">
                    <span class="stats-label">æ ¸å¿ƒç« èŠ‚æ•°ï¼š</span>
                    <span class="stats-value" id="proposal-core-count">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å¯é€‰ç« èŠ‚æ•°ï¼š</span>
                    <span class="stats-value" id="proposal-optional-count">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">æ€»ç« èŠ‚æ•°ï¼š</span>
                    <span class="stats-value" id="proposal-total-count">0</span>
                </div>
            </div>
        </div>
    </div>

    <script src="frontend/js/core/state-manager.js"></script>
    <script src="frontend/js/core/api-client.js"></script>
    <script src="frontend/js/components/modal-manager.js"></script>
    <script src="frontend/js/components/agent-progress.js"></script>
    <script src="frontend/js/modules/business-plan-generator.js"></script>

    <script>
        // åˆå§‹åŒ–
        const stateManager = new StateManager();
        const apiClient = new APIClient(window.location.origin);
        const modalManager = new ModalManager();
        const agentProgressManager = new AgentProgressManager(modalManager);
        const generator = new BusinessPlanGenerator(apiClient, stateManager, agentProgressManager);

        // æ¸²æŸ“ç« èŠ‚
        function renderChapter(chapter, type) {
            return `
                <div class="chapter ${type}">
                    <div class="chapter-title">${chapter.title}</div>
                    <div class="chapter-desc">${chapter.desc}</div>
                    <div class="chapter-id">ID: ${chapter.id}</div>
                </div>
            `;
        }

        // æ¸²æŸ“å•†ä¸šè®¡åˆ’ä¹¦
        const businessConfig = generator.chapterConfig.business;
        document.getElementById('business-core').innerHTML =
            businessConfig.core.map(ch => renderChapter(ch, 'core')).join('');
        document.getElementById('business-optional').innerHTML =
            businessConfig.optional.map(ch => renderChapter(ch, 'optional')).join('');
        document.getElementById('business-core-count').textContent = businessConfig.core.length;
        document.getElementById('business-optional-count').textContent = businessConfig.optional.length;
        document.getElementById('business-total-count').textContent =
            businessConfig.core.length + businessConfig.optional.length;

        // æ¸²æŸ“äº§å“ç«‹é¡¹ææ–™
        const proposalConfig = generator.chapterConfig.proposal;
        document.getElementById('proposal-core').innerHTML =
            proposalConfig.core.map(ch => renderChapter(ch, 'core')).join('');
        document.getElementById('proposal-optional').innerHTML =
            proposalConfig.optional.map(ch => renderChapter(ch, 'optional')).join('');
        document.getElementById('proposal-core-count').textContent = proposalConfig.core.length;
        document.getElementById('proposal-optional-count').textContent = proposalConfig.optional.length;
        document.getElementById('proposal-total-count').textContent =
            proposalConfig.core.length + proposalConfig.optional.length;

        // è¾“å‡ºåˆ°æ§åˆ¶å°
        console.log('å•†ä¸šè®¡åˆ’ä¹¦é…ç½®:', businessConfig);
        console.log('äº§å“ç«‹é¡¹ææ–™é…ç½®:', proposalConfig);

        // æ£€æŸ¥æ˜¯å¦ç›¸åŒ
        const businessIds = [...businessConfig.core, ...businessConfig.optional].map(ch => ch.id).sort();
        const proposalIds = [...proposalConfig.core, ...proposalConfig.optional].map(ch => ch.id).sort();

        console.log('å•†ä¸šè®¡åˆ’ä¹¦ç« èŠ‚ID:', businessIds);
        console.log('äº§å“ç«‹é¡¹ææ–™ç« èŠ‚ID:', proposalIds);

        const isSame = JSON.stringify(businessIds) === JSON.stringify(proposalIds);
        console.log('ç« èŠ‚é…ç½®æ˜¯å¦ç›¸åŒ:', isSame);

        if (isSame) {
            console.error('âŒ é”™è¯¯ï¼šå•†ä¸šè®¡åˆ’ä¹¦å’Œäº§å“ç«‹é¡¹ææ–™çš„ç« èŠ‚é…ç½®ç›¸åŒï¼');
            alert('âŒ æ£€æµ‹åˆ°é—®é¢˜ï¼šå•†ä¸šè®¡åˆ’ä¹¦å’Œäº§å“ç«‹é¡¹ææ–™çš„ç« èŠ‚é…ç½®ç›¸åŒï¼');
        } else {
            console.log('âœ… æ­£ç¡®ï¼šå•†ä¸šè®¡åˆ’ä¹¦å’Œäº§å“ç«‹é¡¹ææ–™çš„ç« èŠ‚é…ç½®ä¸åŒ');
        }
    </script>
</body>
</html>
