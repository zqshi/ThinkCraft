# 调用前自检清单

## 三层检查清单

**每次调用 Agent 前，必须按层级完成自检。所有第一层检查必须通过，否则禁止调用。**

---

## 第一层：快速优先级自检（必须全部通过 ✅）

- [ ] **职责边界**：prompt 中是否出现"应该包含 1. 2. 3."、"章节结构为"等指令性表述？
  - **违规模式**："应该/应当/需要 + 内容清单"、"包含以下方面/维度：1. 2. 3."、"按照以下结构组织"
  - **处理**：如发现，立即删除列表部分，改为"请运用专业方法论完成任务"

- [ ] **信息完整**：用户原始需求是否完整复制到 prompt？
  - **禁止行为**：使用"详见上文"、"与之前相同"、"参考前述需求"等省略表述
  - **禁止行为**：用自己的语言改写、归纳、总结用户需求
  - **正确做法**：一字不差地复制，或提供文件路径 + 读取说明

- [ ] **任务可执行**：任务描述是否具体、可执行，避免了不可能完成的表述？
  - **违规表述**："与用户对话"、"等待用户回复"、"向用户提问"、"调用其他 Agent"
  - **正确表述**：单向任务（读取 → 处理 → 输出），明确边界

- [ ] **依赖链完整**（多轮调用专项）：第 N 轮是否包含第 1 轮的所有依赖文件？
  - **失忆症患者测试**：如果 Agent 只看当前 prompt，能否完全理解任务上下文？
  - **常见遗漏**：原始需求文档、用户输入文档、所有历史澄清/分析文档
  - **原则**：每轮调用都必须包含完整的依赖链（原始输入 + 所有历史产物）

**🔴 如任何一项未通过，必须修正 prompt 后再调用。**

---

## 第二层：5W1H 详细检查（信息完整性验证）

### ✅ Who - 角色清晰性

- [ ] 是否在"调用元信息"中明确告知 Agent 它是谁？
- [ ] 是否在"边界约束"中明确协调者和 Agent 的职责边界？

### ✅ Where - 位置明确性

- [ ] 是否在"协作上下文"中说明当前在整体流程的哪个阶段？
- [ ] 是否说明在该阶段的哪个具体环节？

### ✅ What - 任务明确性

- [ ] "本次任务"描述是否具体、可执行、边界清晰？
- [ ] 是否明确了"做什么"和"不做什么"？
- [ ] 是否避免了"与用户对话"、"获取用户回复"等 Agent 无法完成的表述？

### ✅ Why - 目的明确性

- [ ] 是否在"本次调用的目的"中说明了为什么要调用这个 Agent？
- [ ] 是否在"调用模式说明"中说明了 Agent 的输出将如何被使用？

### ✅ When - 时序明确性

- [ ] 是否明确说明这是"首次调用"还是"第 N 次调用"？
- [ ] 如果是多轮任务，是否说明了上一轮做了什么？
- [ ] 是否说明了下一轮调用的触发条件和将提供的信息？

### ✅ How - 方法明确性

- [ ] 是否在【任务依赖信息】中提供了完成任务所需的全部信息？
- [ ] 依赖文件是否提供了路径和明确的读取说明（"请使用 Read 工具读取"）？
- [ ] 【输出要求】是否明确（类型、格式、路径、命名、合规要求）？
- [ ] 【禁止事项】是否列出了易混淆的点？

---

## 第三层：违规模式深度扫描（质量保证）

### 🔴 对话暗示类（立即修正）

- [ ] 是否包含"与用户对话"、"向用户提问"？
- [ ] 是否包含"等待用户回复"、"用户回答后"？

### 🔴 职责越界类（立即修正）

- [ ] 是否要求 Agent "调用其他 Agent"？
- [ ] 是否要求 Agent "与用户交互"？
- [ ] 是否要求 Agent 执行协调者的职责（如"请等待我收集回复"）？

### 🔴 上下文缺失类（立即修正）

- [ ] 多轮调用时，是否说明这是第几次调用？
- [ ] 是否提供了完整的历史上下文（上轮问题 + 用户回复）？
- [ ] 是否明确了本次调用的输入来源？

### 🔴 输出要求不明确类（立即修正）

- [ ] 是否明确了输出类型（问题列表/文档/决策判断）？
- [ ] 是否说明了输出格式和文件路径？
- [ ] 是否要求遵守模板规范（提供模板库引用）？

**如发现任何违规项，必须修正后再调用 Agent。**

---

## 自检流程建议

```
第一层 → 未通过 → 修正后重新开始
    ↓ 通过
第二层 → 发现缺失 → 补充信息
    ↓ 通过
第三层 → 发现违规 → 删除/修正
    ↓ 通过
✅ 调用 Agent
```
