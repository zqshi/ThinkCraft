<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•åˆ é™¤é¡¹ç›®</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª é¡¹ç›®åˆ é™¤åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>1. åˆ›å»ºæµ‹è¯•é¡¹ç›®</h2>
        <button onclick="createTestProject()">åˆ›å»ºæµ‹è¯•é¡¹ç›®</button>
        <div id="createResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>2. åˆ é™¤é¡¹ç›®</h2>
        <input type="text" id="projectIdInput" placeholder="è¾“å…¥é¡¹ç›®ID (å¦‚: project_xxx)">
        <button class="danger" onclick="deleteProject()">åˆ é™¤é¡¹ç›®</button>
        <div id="deleteResult" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>3. æŸ¥è¯¢é¡¹ç›®ï¼ˆéªŒè¯åˆ é™¤ï¼‰</h2>
        <input type="text" id="queryProjectIdInput" placeholder="è¾“å…¥é¡¹ç›®ID">
        <button onclick="queryProject()">æŸ¥è¯¢é¡¹ç›®</button>
        <div id="queryResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        async function createTestProject() {
            try {
                showResult('createResult', 'æ­£åœ¨åˆ›å»ºæµ‹è¯•é¡¹ç›®...', 'info');

                const response = await fetch(`${API_URL}/api/projects`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ideaId: `test_idea_${Date.now()}`,
                        name: `æµ‹è¯•é¡¹ç›® ${new Date().toLocaleString()}`,
                        mode: 'development'
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    const projectId = result.data.project.id;
                    document.getElementById('projectIdInput').value = projectId;
                    document.getElementById('queryProjectIdInput').value = projectId;

                    showResult('createResult',
                        `âœ… åˆ›å»ºæˆåŠŸï¼\n\né¡¹ç›®ID: ${projectId}\né¡¹ç›®åç§°: ${result.data.project.name}\nçŠ¶æ€: ${result.data.project.status}`,
                        'success'
                    );
                } else {
                    showResult('createResult',
                        `âŒ åˆ›å»ºå¤±è´¥\n\né”™è¯¯: ${result.error || result.message}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('createResult',
                    `âŒ è¯·æ±‚å¤±è´¥\n\né”™è¯¯: ${error.message}\n\nè¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ (npm run dev)`,
                    'error'
                );
            }
        }

        async function deleteProject() {
            const projectId = document.getElementById('projectIdInput').value.trim();

            if (!projectId) {
                showResult('deleteResult', 'âŒ è¯·è¾“å…¥é¡¹ç›®ID', 'error');
                return;
            }

            try {
                showResult('deleteResult', `æ­£åœ¨åˆ é™¤é¡¹ç›®: ${projectId}...`, 'info');

                const response = await fetch(`${API_URL}/api/projects/${projectId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showResult('deleteResult',
                        `âœ… åˆ é™¤æˆåŠŸï¼\n\né¡¹ç›®ID: ${projectId}\nå“åº”: ${JSON.stringify(result, null, 2)}`,
                        'success'
                    );
                    document.getElementById('queryProjectIdInput').value = projectId;
                } else {
                    showResult('deleteResult',
                        `âŒ åˆ é™¤å¤±è´¥ (HTTP ${response.status})\n\né”™è¯¯: ${result.error || result.message}\n\nå®Œæ•´å“åº”:\n${JSON.stringify(result, null, 2)}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('deleteResult',
                    `âŒ è¯·æ±‚å¤±è´¥\n\né”™è¯¯: ${error.message}`,
                    'error'
                );
            }
        }

        async function queryProject() {
            const projectId = document.getElementById('queryProjectIdInput').value.trim();

            if (!projectId) {
                showResult('queryResult', 'âŒ è¯·è¾“å…¥é¡¹ç›®ID', 'error');
                return;
            }

            try {
                showResult('queryResult', `æ­£åœ¨æŸ¥è¯¢é¡¹ç›®: ${projectId}...`, 'info');

                const response = await fetch(`${API_URL}/api/projects/${projectId}`);
                const result = await response.json();

                if (response.ok) {
                    const project = result.data.project;
                    showResult('queryResult',
                        `âœ… æŸ¥è¯¢æˆåŠŸ\n\né¡¹ç›®ID: ${project.id}\né¡¹ç›®åç§°: ${project.name}\nçŠ¶æ€: ${project.status}\nåˆ›å»ºæ—¶é—´: ${new Date(project.createdAt).toLocaleString()}\næ›´æ–°æ—¶é—´: ${new Date(project.updatedAt).toLocaleString()}\n\n${project.status === 'deleted' ? 'âš ï¸ è¯¥é¡¹ç›®å·²è¢«è½¯åˆ é™¤' : ''}`,
                        project.status === 'deleted' ? 'info' : 'success'
                    );
                } else {
                    showResult('queryResult',
                        `âŒ æŸ¥è¯¢å¤±è´¥ (HTTP ${response.status})\n\né”™è¯¯: ${result.error || result.message}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('queryResult',
                    `âŒ è¯·æ±‚å¤±è´¥\n\né”™è¯¯: ${error.message}`,
                    'error'
                );
            }
        }
    </script>
</body>
</html>
