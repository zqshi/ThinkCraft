# 文档元信息与合规自检

> 为确保所有模板产物一致、可审计、可复用，执行以下强制规范

---

## 文档头部元信息（必须包含）

所有文档必须在头部包含以下元信息：

```markdown
**Template**: [模板名称]
**Version**: v{YYYYMMDDHHmmss}
**Changelog**: {时间} - {修改人} - {修改原因摘要}
```

**示例**：

```markdown
**Template**: 需求澄清分析文档-模板
**Version**: v20260127143022
**Changelog**: 2026-01-27 - product-demand-manager-agent - 初始创建
```

---

## 写作-落盘-校验-确认流程

### 1) 写作前绑定模板

- 先读取共享模板库，确定模板名称与结构
- 明确使用哪个模板，记录模板名称

### 2) 落盘写入

- 按照模板章节与字段落盘至约定目录
- 使用时间戳版本号（YYYYMMDDHHmmss）

### 3) 自动回读校验

- 写入后立即回读，校验章节完整性与必填字段
- 检查是否所有模板要求的章节都已包含

### 4) 用户确认

- 用户明确确认后方可推进下一阶段
- 未获确认不得进入下一流程

---

## 章节匹配校验规则

### 强制要求

- 模板中的一级/二级标题与字段名必须在产出文档中一一对应出现
- 不得随意增删或改名模板固定章节
- 扩展内容需作为"附录/补充"添加

### 违规示例

❌ 删除模板中的必填章节
❌ 修改模板章节的标题名称
❌ 在模板章节之间插入自定义章节

### 正确示例

✅ 严格按照模板章节顺序组织
✅ 所有必填章节都已包含
✅ 扩展内容放在"附录"或"补充说明"章节

---

## 合规自检清单（最低集）

### 必检项（所有文档）

- [ ] **模板匹配**：已使用正确的模板，章节结构与模板一致
- [ ] **元信息完整**：包含 Template、Version、Changelog 三项元信息
- [ ] **目录与命名符合规范**：文件命名和存放路径符合规范
- [ ] **依赖/来源存在且路径正确**：依赖的文档存在且路径正确
- [ ] **已获上一阶段用户确认**：上一阶段已完成并获得用户明确确认（首次调用除外）
- [ ] **核心原则符合**：功能为中心、无全局流程依赖、可测试性、结构化与可解析、约束显式

### 特殊检查项（按文档类型）

**需求设计类文档**：

- [ ] **用户故事格式**：采用"作为...我想要...以便于..."三段式
- [ ] **验收标准格式**：采用 Given-When-Then 格式，覆盖正常/异常/边界场景

**挑战回应类文档**：

- [ ] **人类决策区完整**：每个挑战问题都包含预留的"人类裁决"区域

**调研类文档**：

- [ ] **数据来源可靠**：所有数据来源已明确标注

---

## 变更留痕机制

### Changelog 格式

```markdown
**Changelog**:

- 2026-01-27 14:30 - agent-name - 初始创建
- 2026-01-28 10:15 - agent-name - 根据用户反馈修改第3章
- 2026-01-28 15:20 - agent-name - 补充验收标准
```

### 记录要求

- 每次修改都必须记录
- 包含时间、修改人、修改原因
- 修改原因要简洁明确

---

## 执行责任

### Agent 责任

- 生成文档前必须查阅模板
- 生成文档后必须执行合规自检
- 发现不合规项必须立即修正

### 协调者责任

- 验证文档合规性
- 不合格的文档要求重新生成
- 确保流程门禁执行

### 人类责任

- 审查文档质量
- 明确确认后方可推进
- 提供修改意见和反馈

---

## 常见问题

### Q1: 如果模板章节不适用怎么办？

A: 保留章节标题，在内容区域注明"本项目不适用"或"暂无"，不得删除章节。

### Q2: 可以调整章节顺序吗？

A: 不可以。必须严格按照模板的章节顺序组织文档。

### Q3: 可以添加自定义章节吗？

A: 可以，但必须放在"附录"或"补充说明"章节中，不得插入到模板章节之间。

### Q4: 版本号如何生成？

A: 使用时间戳格式 YYYYMMDDHHmmss，例如 v20260127143022。

### Q5: 如果发现模板有问题怎么办？

A: 先按照现有模板完成文档，然后在反馈中说明模板问题，由维护者统一修改模板。
