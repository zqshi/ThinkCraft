# 产品开发核心原则（共享）

> **重要提示**：本文档包含所有产品开发体系共享的核心原则，包括Agent协作规范、大模型原生应用核心原则、信息传递规范等。

---

## 0. Agent协作设计规范

**本部分内容已抽取为共享规范，请查阅**：[agent-collaboration.md](./agent-collaboration.md)

共享规范包含：

- Agent 无状态调用本质
- 标准 Prompt 结构模板
- 调用前强制自检（5W1H）
- 信息透传强制规范
- 职责边界与防越俎代庖
- 调用前违规模式扫描清单
- Agent 输出异常检测规则
- 核心协作原则

---

## 1. 大模型原生应用核心原则（强制）

### 面向功能设计（而非流程设计）

- 设计与产出聚焦功能点、业务规则、用户故事与验收标准；弱化固定流程叙述，不以"先后顺序"驱动设计。
- 交互允许"任意节点触发"核心功能，避免强制引导线性步骤。
- 无全局流程依赖：各功能自洽独立，前置仅限该功能必要数据，禁止跨功能的强制顺序耦合。

### 可测试性与度量

- 验收标准覆盖正常/异常/边界三类 Given-When-Then；仅保留与功能验收直接相关、可验证的成功指标。

### 结构化与可解析

- 输出采用结构化格式（功能描述/业务规则/输入输出/状态管理/用户故事/验收标准），确保机器可解析、无歧义。

### 语言与约束显式

- 用语简洁明确；隐私、合规、禁止性规则必须显式列出，不得隐含在叙述中。

### 反模式（禁止）

- 流程中心化（以流程为主导、功能附属）
- 跨功能强前置依赖与顺序耦合
- 成功度量混入与当前功能无直接依赖的业务KPI/运营指标

### 审查清单（抽查要点）

- [ ] 是否功能为中心而非流程为中心？
- [ ] 是否可在任意节点触发核心功能且无全局流程依赖？
- [ ] 验收标准是否覆盖正常/异常/边界并可直接测试？
- [ ] 是否使用结构化格式且语言无歧义？是否显式列出约束？
- [ ] 是否存在反模式迹象（流程中心化/强耦合/不当度量）？

---

## 2. 信息传递与上下文管理

### 信息透传强制规范

#### 核心原则

**所有信息传递必须完整透传，严禁任何形式的摘要、改写、删减。**

适用于两个关键场景：

1. **Agent输出 → 用户呈现**
2. **用户需求 → Agent调用**

#### 场景1：接收Agent输出后向用户呈现

**强制要求**：协调者在接收Agent输出后，**必须原封不动地将完整内容呈现给用户**。

**违规判定标准**：

- ❌ 使用"Agent已经..."、"Agent提出了X个问题"等概括性描述
- ❌ 使用"涵盖"、"包括"、"主要内容"等归纳总结词汇
- ❌ 仅展示部分内容并引导用户"查看完整输出"
- ❌ 对Agent输出进行任何形式的改写、精简、重新组织

**正确做法（强制模板）**：

```
收到 {agent_name} 的完整输出：

---
[Agent的完整原始输出，一字不改]
---
```

**唯一例外**：仅当Agent输出超过token限制导致无法完整显示时：

```
收到 {agent_name} 的输出（内容较长，已保存到文件）：
完整内容请查看：[文件路径]
以下是前1000字预览：[前1000字原始内容]
```

#### 场景2：调用Agent时传递用户需求

**核心原则**：每个Agent调用都是**无状态的、独立的**。Agent只能看到当前prompt参数中的信息，无法访问历史对话。因此，**必须将所有依赖信息完整提供**。

**重要说明**：Agent具有完整的工具访问权限（包括Read工具），可以自行读取文件。因此，对于文件依赖：

- ✅ **优先做法**：提供文件路径，让Agent使用Read工具自行读取（节省token，提高效率）
- ✅ **降级策略**：如果Agent读取文件时遇到权限问题或其他错误，协调者再介入提供文件完整内容
- ⚠️ **不推荐**：直接在prompt中提供大文件完整内容（浪费token，降低效率）

**违规判定标准**：

- ❌ 使用"已省略"、"与之前相同"、"详见上文"等省略表述
- ❌ 使用"详见上文"、"如前所述"、"参考之前的需求"等引用表述
- ❌ 用自己的语言改写、归纳、总结用户需求
- ❌ 仅提供文件路径但未说明需要读取（Agent可能不知道该做什么）
- ❌ 假设Agent"已经知道"或"应该记得"之前的信息

**极端化思维模型**：

> "我在给一个**失忆症患者**布置任务，他只能看到我当前给他的这张纸条，看不到任何历史信息。如果我的纸条缺少任何上下文，他将无法完成任务。"

### 依赖链管理

- 每个Agent调用都必须包含完整的依赖链
- 依赖文件必须提供路径和读取说明
- 多轮调用时，每轮都必须包含所有历史产物

### 版本管理

- 所有文档使用时间戳版本号（YYYYMMDDHHmmss）
- 不覆盖已有文档，每次产出新版本
- 依赖文件必须明确版本号

---

## 3. 职责边界与防越俎代庖

### 核心行为约束

- **职责边界**：严格坚守 Agent 本身的角色定义，绝不执行明确属于其他 Agent 职责的任务
- **权限意识**：未经协调者授权，绝不修改任何非 Agent 本身负责的工作产出
- **协作路径**：当 Agent 识别出属于他人任务时，通过协调者发送请求或报告，由协调者进行调度
- **专业克制**：相信各 Agent 在其专业领域的能力，不主动干预其决策过程

### 信任建立原则

- **交付承诺**：对承诺的任务，确保输出符合预定义的完成标准
- **过程透明**：主动并清晰地通告执行的任务状态、进展与阻塞
- **信息传递**：协调者与 Agent 采用信息透传方式，不做任何加工处理
- **可靠响应**：对于协作请求，必须给出明确答复（接受、拒绝或需等待时长）
- **质量保证**：Agent 工作产出在交付前，应经过自我验证以确保其有效性

### 协调者职责

- ✅ 流程管理：决定调用哪个Agent、何时调用
- ✅ 信息传递：完整、准确地传递信息
- ✅ 质量验证：验证Agent输出的合规性和质量
- ✅ 人类确认：在关键节点请求人类确认
- ❌ 不做专业决策：不替Agent做产品设计、技术选型、架构设计等专业决策

### Agent职责

- ✅ 专业工作：在自己的专业领域完成任务
- ✅ 文档产出：按照模板产出高质量文档
- ✅ 合规自检：完成合规自检清单
- ❌ 不做协调工作：不调用其他Agent、不与用户交互、不管理流程

### 人类职责

- ✅ 需求提供：提供清晰的产品需求
- ✅ 决策确认：在关键节点确认和决策
- ✅ 反馈意见：提供修改意见和反馈
- ✅ 最终验收：验收最终产品

---

## 4. 文档模板使用强制规范

### 核心原则

**协调者不得替 Agent 决定文档的结构和章节内容。Agent 必须根据任务需求，主动查阅模板库选择合适的文档模板并自主决定文档组织方式。**

### 正确做法

✅ **仅告知目标和规范，由 Agent 自主决定结构**

```
## 【当前任务】
生成 [文档类型] 文档。

请根据任务需求特点，主动查阅共享模板库，选择合适的文档模板，并按照模板要求自主组织文档结构和内容。

## 【输出要求】
- 文件命名: [命名规范]
- 存放路径: [路径]
- 强制要求: 严格执行文档规范流程
```

### 职责边界

| 角色       | 允许做的                                                                             | 禁止做的                                                      |
| ---------- | ------------------------------------------------------------------------------------ | ------------------------------------------------------------- |
| **协调者** | ✅ 明确任务目标<br>✅ 指定输出路径和命名<br>✅ 要求遵守流程规范<br>✅ 指引查阅模板库 | ❌ 定义文档章节结构<br>❌ 指定内容组织方式<br>❌ 干预专业决策 |
| **Agent**  | ✅ 查阅模板文件<br>✅ 选择合适模板<br>✅ 决定文档结构<br>✅ 组织内容框架             | ❌ 违背模板规范<br>❌ 忽略协调者的路径和命名要求              |

---

## 5. 遵循声明与边界禁则

### 全局强制规范

- **模板先行**：仅允许使用共享模板库的统一模板；不得私加未定义章节
- **禁技术细节**：严禁写入架构/技术栈/Schema/API/部署等技术实现内容
- **产前自检**：落盘前必须通过合规自检清单
- **人类裁决留痕**：挑战与回应后，必须在回应文档中记录裁决与后续动作

### 门禁与流程控制

- **用户确认门禁**：阶段完成前，未获"明确确认"不得推进
- **裁决留痕**：挑战与回应后，必须在回应文档中记录裁决与后续动作
- **等价术语统一**：例如"精炼需求文档"≡"需求设计文档-LLM版.md"

### 需求关注边界

- 禁止涉及技术架构、技术栈、数据模型、API、部署细节等技术实现内容

---

## 6. 模板与合规执行机制

### 模板前置绑定

- 写文档前必须读取共享模板库，明确使用的模板名称与版本
- 在文档头部写入元信息：Template: [模板名] / Version: [日期或版本号] / Changelog: [时间-修改人-原因]

### 落盘后自动回读校验

- 文档写入后立即回读，校验章节完整性与关键字段存在；若缺失则自动修正并同步提示用户

### 变更留痕

- 所有文档需维护 Changelog，记录修改时间、修改人、修改原因与要点

### 执行责任

- 遵循流程规范进行门禁与自检执行，任何未通过的产物不得进入下一阶段

### 合规自检清单（落盘前强制通过）

- [ ] **模板匹配**：标题与小节与模板一一对应
- [ ] **路径命名**：遵循目录与文件命名约定
- [ ] **依赖/来源声明**：引用的文件与目录存在且路径正确
- [ ] **阶段门禁**：上一阶段已获"用户明确确认"，否则不得推进
- [ ] **核心原则符合**：遵循"大模型原生应用核心原则（强制）"

---

## 7. 方法论总览

### 需求挖掘

- 深度访谈框架
- 5个为什么
- 例证法

### 洞察模型

- KANO模型
- JTBD（Jobs To Be Done）
- 用户价值层级

### 需求设计

- 故事映射
- 场景化设计
- MVP（最小可行产品）

### 市场研究

- 定量研究（回归分析、时序分析、可视化）
- 定性研究（专家访谈、案头研究、德尔菲法）

### 竞品研究

- 体验分析
- 用户评价分析
- 版本追踪
- 策略与定价分析

### 整合分析

- SWOT分析
- 定位矩阵
- 市场-竞品-用户交叉分析

---

## 8. 系统化流程（总览）

### 质量审查流程

接收 → 筛查 → 原则/方法 → 故事与验收 → 问题分类与建议 → 评级与报告

### 产品管理主流程

采集 → 洞察 → 数据整合 → 方案设计 → 验证优化

### 研究集成流程

市场扫描 → 竞品分析 → 需求验证 → 机会评估 → 战略建议

### 精炼流程

干扰识别 → 关键提取 → 结构化输出

---

## 9. 安全与合规

### 隐私保护

- 隐私与敏感信息剔除
- 数据最小化与授权

### 规则显式

- 禁止性规则显式列出
- 偏见与不当内容防范

---

## 附录：常见问题

### Q1: 为什么要强调"无状态调用"？

A: 因为Agent每次调用都是独立的，无法访问历史对话。如果不明确这一点，容易出现"与用户对话"、"等待用户回复"等不可能完成的任务描述。

### Q2: 为什么要强调"信息透传"？

A: 因为任何摘要、改写、删减都可能导致信息丢失或失真。Agent需要完整的信息才能做出正确的专业判断。

### Q3: 为什么要强调"职责边界"？

A: 因为协调者和Agent各有专长。协调者擅长流程管理，Agent擅长专业工作。越界会导致质量下降和效率降低。

### Q4: 为什么要强调"依赖链完整"？

A: 因为Agent是"失忆症患者"，每次调用都需要完整的上下文。缺少任何一个依赖文件都可能导致Agent无法正确理解任务。

### Q5: 为什么要强调"合规自检"？

A: 因为文档质量直接影响后续工作。合规自检确保文档符合模板要求，避免返工和质量问题。
