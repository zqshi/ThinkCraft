<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script>
        // âœ… æ£€æŸ¥æ˜¯å¦åœ¨ç™»å½•ç›¸å…³é¡µé¢
        const isLoginPage = /\/(login|OS)\.html(?:[?#]|$)/.test(window.location.pathname);
        const isLoggedIn = sessionStorage.getItem('thinkcraft_logged_in') === 'true';

        // âœ… æœªç™»å½•ä¸”ä¸åœ¨ç™»å½•é¡µé¢ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
        if (!isLoggedIn && !isLoginPage) {
            console.log('[è®¤è¯æ£€æŸ¥] æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
            window.location.replace('login.html' + window.location.search + window.location.hash);
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ThinkCraft - AIæ€ç»´åŠ©æ‰‹</title>
    <link rel="icon" href="/favicon.ico">

    <!-- PWAé…ç½® -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ThinkCraft">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192.png">

    <!-- SEOä¼˜åŒ– -->
    <meta name="description" content="å¿«é€Ÿæ•æ‰çµæ„Ÿï¼Œé€šè¿‡è‹æ ¼æ‹‰åº•å¼æé—®æ·±åŒ–æ€ç»´ï¼ŒAIè¾…åŠ©ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦">
    <meta name="keywords" content="AIåŠ©æ‰‹,æ€ç»´å·¥å…·,çµæ„Ÿè®°å½•,å•†ä¸šè®¡åˆ’,åˆ›æ„åˆ†æ">

    <!-- CSSæ–‡ä»¶ä»publicç›®å½•åŠ è½½ï¼Œé¿å…FOUC -->
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/main.css">

    <script src="/frontend/js/core/device-detector.js"></script>
    <script src="/frontend/js/core/gesture-handler.js"></script>
    <script src="/frontend/js/core/state-validator.js"></script>
    <script src="/frontend/js/utils/error-handler.js"></script>

    <!-- å…³é”®CSSï¼šç¡®ä¿ç§»åŠ¨ç«¯ä¾§è¾¹æ é»˜è®¤éšè—ï¼ˆåœ¨å¤–éƒ¨CSSåŠ è½½å‰ç”Ÿæ•ˆï¼‰ -->
    <style>
        @media (max-width: 640px) {
            .sidebar {
                position: absolute !important;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 100;
                width: 100%;
                transform: translateX(-100%) !important;
                transition: transform 0.3s ease;
            }
            .sidebar.active {
                transform: translateX(0) !important;
            }
            .menu-toggle {
                display: block !important;
            }
            .main-content {
                width: 100% !important;
                margin-left: 0 !important;
            }

            /* ç§»åŠ¨ç«¯æ‚¬æµ®è¾“å…¥åŒºï¼šå›ºå®šåœ¨åº•éƒ¨ */
            .input-container {
                position: fixed !important;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 50;
                background: white;
                box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
                padding: 12px;
                padding-bottom: calc(12px + env(safe-area-inset-bottom));
            }

            /* è°ƒæ•´èŠå¤©å®¹å™¨åº•éƒ¨è¾¹è·ï¼Œä¸ºæ‚¬æµ®è¾“å…¥åŒºç•™å‡ºç©ºé—´ */
            .chat-container {
                padding-bottom: calc(120px + env(safe-area-inset-bottom)) !important;
            }
        }

        /* æ¡Œé¢ç«¯ï¼šèœå•æŒ‰é’®é»˜è®¤éšè— */
        .menu-toggle {
            display: none;
        }

    <!-- å“åº”å¼ä¼˜åŒ–ï¼šå¼¹çª—æŒ‰é’®æ ·å¼ -->
        /* ============ æ¡Œé¢ç«¯ä¼˜åŒ– - æ‰€æœ‰å¼¹çª—æŒ‰é’®æ›´ç´§å‡‘ ============ */
        @media (min-width: 768px) {
            /* å…¨å±€å¼¹çª—æŒ‰é’®ä¼˜åŒ– */
            .modal-footer .btn-primary,
            .modal-footer .btn-secondary {
                padding: 8px 16px !important;
                font-size: 13px !important;
                border-radius: 6px !important;
            }

            /* æŠ¥å‘Šå¼¹çª—åº•éƒ¨æŒ‰é’®ä¼˜åŒ– */
            #reportModal .modal-footer .btn-primary,
            #reportModal .modal-footer .btn-secondary {
                padding: 8px 16px !important;
                font-size: 13px !important;
                border-radius: 6px !important;
            }

            /* æ·±åº¦åˆ†ææŒ‰é’®ç»„ */
            #reportModal .modal-footer .generation-btn {
                padding: 10px 18px !important;
                font-size: 14px !important;
            }

            #reportModal .modal-footer .generation-btn .btn-icon {
                font-size: 16px !important;
            }

            /* æ·±åº¦åˆ†ææ¨¡å—ä¼˜åŒ– */
            #reportModal .modal-footer > div:first-child {
                padding: 14px !important;
            }

            /* æ“ä½œæŒ‰é’®å®¹å™¨é—´è·ä¼˜åŒ– */
            #reportModal .modal-footer > div:last-child {
                gap: 10px !important;
            }

            /* å¯¹è¯æ¶ˆæ¯ä¸­çš„æŒ‰é’®ä¼˜åŒ– */
            .view-report-btn,
            .share-btn,
            .action-chip {
                padding: 8px 14px !important;
                font-size: 13px !important;
                border-radius: 6px !important;
            }

            /* è®¾ç½®å¼¹çª—æŒ‰é’®ä¼˜åŒ– */
            #settingsModal .modal-footer .btn-primary,
            #settingsModal .modal-footer .btn-secondary {
                padding: 8px 16px !important;
                font-size: 13px !important;
            }
        }

        /* ============ ç§»åŠ¨ç«¯ä¿æŒå‹å¥½å°ºå¯¸ ============ */
        @media (max-width: 767px) {
            /* ç§»åŠ¨ç«¯æŒ‰é’®ä¿æŒè§¦æ‘¸å‹å¥½çš„å¤§å° */
            .modal-footer .btn-primary,
            .modal-footer .btn-secondary {
                min-height: 44px; /* ç§»åŠ¨ç«¯æœ€å°å¯è§¦æ‘¸å°ºå¯¸ */
                padding: 10px 20px;
            }

            #reportModal .modal-footer .btn-primary,
            #reportModal .modal-footer .btn-secondary {
                min-height: 44px;
            }

            /* å¯¹è¯æ¶ˆæ¯ä¸­çš„æŒ‰é’®ç§»åŠ¨ç«¯ä¿æŒåŸæ · */
            .view-report-btn,
            .share-btn,
            .action-chip {
                min-height: 40px;
                padding: 10px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">ThinkCraft</div>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                    æ–°å»ºå¯¹è¯
                </button>
            </div>

            <!-- Sidebaråˆ‡æ¢Tab -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="chats" onclick="switchSidebarTab('chats')">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    <span>å¯¹è¯</span>
                </button>
                <button class="sidebar-tab" data-tab="team" onclick="switchSidebarTab('team')" id="teamTab" >
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    <span>é¡¹ç›®ç©ºé—´</span>
                </button>
            </div>

            <!-- å¯¹è¯åˆ—è¡¨è§†å›¾ -->
            <div class="sidebar-view" id="chatsView">
                <div class="chat-history" id="chatHistory"></div>
            </div>

            <!-- å›¢é˜Ÿç©ºé—´è§†å›¾ -->
            <div class="sidebar-view" id="teamView" style="display: none;">
                <!-- é¡¹ç›®åˆ—è¡¨å®¹å™¨ -->
                <div id="projectListContainer"></div>
            </div>

            <!-- Sidebaråº•éƒ¨ï¼šç”¨æˆ·ä¿¡æ¯åŒº -->
            <div class="sidebar-footer">
                <div class="user-info" onclick="openBottomSettings()">
                    <div class="user-avatar">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                        </svg>
                    </div>
                    <div class="user-name" id="userName">ThinkCraft ç”¨æˆ·</div>
                    <button class="settings-icon" onclick="event.stopPropagation(); openBottomSettings()" aria-label="è®¾ç½®">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <!-- ç§»åŠ¨ç«¯ï¼šå·¦ä¾§æ±‰å ¡èœå• -->
                <button class="menu-toggle" onclick="toggleSidebar()" aria-label="æ‰“å¼€èœå•">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>

                <div class="main-title" id="mainTitle">ThinkCraft AI</div>

                <div class="header-actions">
                    <!-- ç§»åŠ¨ç«¯ï¼šæ–°å»ºå¯¹è¯æŒ‰é’® -->
                    <button class="mobile-new-chat-btn" onclick="startNewChat()" title="æ–°å»ºå¯¹è¯" aria-label="æ–°å»ºå¯¹è¯">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                    </button>
                    <!-- æ¡Œé¢ç«¯ï¼šè®¾ç½®æŒ‰é’® -->
                    <button class="icon-btn desktop-only" onclick="showSettings()" title="è®¾ç½®">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="chat-container" id="chatContainer">
                <div class="empty-state" id="emptyState">
                    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    <div class="empty-title">è‹æ ¼æ‹‰åº•å¼æ€ç»´å¼•å¯¼</div>
                    <div class="empty-subtitle">é€šè¿‡æ·±åº¦æé—®ï¼Œå¸®åŠ©ä½ ç†æ¸…åˆ›æ„æ€è·¯ã€å‘ç°ç›²ç‚¹ã€å½¢æˆç»“æ„åŒ–æ´å¯Ÿ</div>
                    <!-- å¿«é€Ÿå¼€å§‹å¡ç‰‡å·²éšè— -->
                </div>
                <div id="messageList" style="display: none;"></div>
            </div>

            <!-- é¡¹ç›®å³ä¾§é¢æ¿ -->
            <aside class="project-panel" id="projectPanel" style="display: none;">
                <div class="project-panel-header">
                    <div class="project-panel-title" id="projectPanelTitle">é¡¹ç›®è¯¦æƒ…</div>
                    <div class="project-panel-header-actions">
                        <!-- çŸ¥è¯†åº“å…¥å£å·²æš‚æ—¶å±è”½ï¼Œåç»­æŒ‰éœ€å¼€æ”¾ -->
                        <!--
                        <button class="icon-btn" onclick="projectManager.openProjectKnowledgePanel()" title="é¡¹ç›®çŸ¥è¯†åº“">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                        </button>
                        -->
                        <button class="icon-btn" onclick="projectManager.editCurrentProjectName()" title="ç¼–è¾‘é¡¹ç›®">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 7.125L16.862 4.487"/>
                            </svg>
                        </button>
                        <button class="icon-btn icon-btn-danger" onclick="projectManager.confirmDeleteCurrentProject()" title="åˆ é™¤é¡¹ç›®">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7V4a1 1 0 011-1h4a1 1 0 011 1v3m4 0H5"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="project-panel-body" id="projectPanelBody"></div>
            </aside>

            <!-- çŸ¥è¯†åº“é¢æ¿ï¼ˆå³ä¾§åˆ‡æ¢é¢æ¿ï¼‰-->
            <div class="knowledge-panel" id="knowledgePanel" style="display: none;">
                <div class="knowledge-panel-content">
                    <!-- å·¦ä¾§ï¼šç»„ç»‡æ ‘ -->
                    <div class="knowledge-sidebar">
                        <div class="knowledge-org-switcher">
                            <button class="active" data-org="byType" onclick="switchKnowledgeOrg('byType')">æŒ‰ç±»å‹</button>
                            <button data-org="byTimeline" onclick="switchKnowledgeOrg('byTimeline')">æ—¶é—´çº¿</button>
                            <button data-org="byTags" onclick="switchKnowledgeOrg('byTags')">æ ‡ç­¾</button>
                        </div>
                        <div id="knowledgeOrgTree" class="knowledge-org-tree"></div>
                    </div>

                    <!-- å³ä¾§ï¼šçŸ¥è¯†åˆ—è¡¨ -->
                    <div class="knowledge-main">
                        <div class="knowledge-toolbar">
                            <input type="text" id="knowledgeSearch" placeholder="æœç´¢çŸ¥è¯†..." oninput="onKnowledgeSearch(this.value)">
                            <select id="knowledgeTypeFilter" onchange="onKnowledgeTypeFilter(this.value)">
                                <option value="">æ‰€æœ‰ç±»å‹</option>
                                <option value="prd">PRD</option>
                                <option value="tech">æŠ€æœ¯æ–¹æ¡ˆ</option>
                                <option value="analysis">å¸‚åœºåˆ†æ</option>
                                <option value="research">è°ƒç ”æŠ¥å‘Š</option>
                                <option value="design">è®¾è®¡æ–‡æ¡£</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                            <button class="btn-primary" onclick="createKnowledge()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                æ–°å»º
                            </button>
                        </div>
                        <div id="knowledgeList" class="knowledge-grid"></div>
                        <div id="knowledgeEmpty" class="empty-state" style="display: none;">
                            <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                            <div class="empty-title">æš‚æ— çŸ¥è¯†æ²‰æ·€</div>
                            <div class="empty-subtitle">åˆ›å»ºç¬¬ä¸€ä¸ªçŸ¥è¯†æ¡ç›®</div>
                            <button class="btn-primary" onclick="createKnowledge()" style="margin-top: 16px;">æ–°å»ºçŸ¥è¯†</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container" id="inputContainer">
                <div class="input-wrapper">
                    <!-- ç§»åŠ¨ç«¯ï¼šè¯­éŸ³æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ -->
                    <div class="mobile-voice-mode" id="mobileVoiceMode">
                        <button class="mobile-tool-btn" onclick="handleCamera()" title="æ‹ç…§" aria-label="æ‹ç…§">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>

                        <button class="mobile-voice-btn" id="mobileVoiceBtn">
                            <svg width="22" height="22" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                            </svg>
                            <span>æŒ‰ä½è¯´è¯</span>
                        </button>

                        <button class="mobile-tool-btn" onclick="handleImageUpload()" title="å›¾ç‰‡" aria-label="ä¸Šä¼ å›¾ç‰‡">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </button>

                        <button class="mobile-tool-btn" onclick="switchToTextMode()" title="åˆ‡æ¢æ–‡å­—è¾“å…¥" aria-label="åˆ‡æ¢æ–‡å­—è¾“å…¥">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- ç§»åŠ¨ç«¯ï¼šæ–‡æœ¬æ¨¡å¼ -->
                    <div class="mobile-text-mode" id="mobileTextMode" style="display: none;">
                        <button class="mobile-tool-btn-small" onclick="switchToVoiceMode()" title="åˆ‡æ¢è¯­éŸ³è¾“å…¥" aria-label="åˆ‡æ¢è¯­éŸ³è¾“å…¥">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                            </svg>
                        </button>
                        <button class="mobile-tool-btn-small" onclick="handleCamera()" title="æ‹ç…§" aria-label="æ‹ç…§">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                        <button class="mobile-tool-btn-small" onclick="handleImageUpload()" title="å›¾ç‰‡" aria-label="ä¸Šä¼ å›¾ç‰‡">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </button>
                        <textarea
                            class="mobile-text-input"
                            id="mobileTextInput"
                            placeholder="è¾“å…¥æ¶ˆæ¯..."
                            rows="1"
                            onkeydown="handleKeyDown(event)"
                            oninput="autoResize(this)"
                        ></textarea>
                        <button class="mobile-send-btn" onclick="sendMessage()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                        </button>
                    </div>

                    <!-- æ¡Œé¢ç«¯ï¼šæ–‡æœ¬æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ -->
                    <div class="desktop-text-mode" id="desktopTextMode">
                        <div class="desktop-input-tools">
                            <button class="desktop-tool-btn" onclick="handleImageUpload()" title="ä¸Šä¼ å›¾ç‰‡" aria-label="ä¸Šä¼ å›¾ç‰‡">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="desktop-input-box">
                            <textarea
                                class="desktop-text-input"
                                id="mainInput"
                                placeholder="åˆ†äº«ä½ çš„åˆ›æ„æƒ³æ³•ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ·±åº¦å¯¹è¯æ¥æ¢ç´¢å®ƒçš„å¯èƒ½æ€§..."
                                rows="1"
                            ></textarea>
                        </div>
                        <button class="desktop-send-btn" id="sendBtn">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            </div>
        </main>
    </div>

    <!-- è¯¦ç»†æŠ¥å‘Šæ¨¡æ€æ¡† -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <div class="modal-title">åˆ›æ„æ€ç»´ç»“æ„åŒ–åˆ†ææŠ¥å‘Š</div>
                </div>
                <button class="close-btn" onclick="closeReport()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body" id="reportContent">
                <!-- æŠ¥å‘Šå†…å®¹å°†åŠ¨æ€æ’å…¥ -->
            </div>

            <div class="modal-footer">
                <!-- æ·±åº¦åˆ†ææ¨¡å— -->
                <div class="report-deep-analysis" style="background: var(--bg-secondary); padding: 16px; border-radius: 12px;">
                    <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ“ˆ</span>
                        <span>æ·±åº¦åˆ†æ</span>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button
                            id="businessPlanBtn"
                            class="btn-primary generation-btn btn-idle"
                            data-type="business"
                            data-status="idle"
                            style="flex: 1;">
                            <span class="btn-icon">ğŸ“Š</span>
                            <span class="btn-text">å•†ä¸šè®¡åˆ’ä¹¦</span>
                        </button>
                        <button
                            id="proposalBtn"
                            class="btn-primary generation-btn btn-idle"
                            data-type="proposal"
                            data-status="idle"
                            style="flex: 1;">
                            <span class="btn-icon">ğŸ“‹</span>
                            <span class="btn-text">äº§å“ç«‹é¡¹ææ–™</span>
                        </button>
                    </div>
                </div>

                <!-- æŠ¥å‘Šæ“ä½œæŒ‰é’® -->
                <div class="report-actions">
                    <button class="btn-secondary" onclick="regenerateInsightsReport()">
                        ğŸ”„ é‡æ–°ç”Ÿæˆ
                    </button>
                    <button class="btn-secondary" onclick="exportFullReport()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline; vertical-align: middle; margin-right: 4px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                        </svg>
                        å¯¼å‡ºPDF
                    </button>
                    <button class="btn-primary" id="shareLinkBtn" onclick="generateShareLink()" style="display: none;">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline; vertical-align: middle; margin-right: 4px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                        </svg>
                        åˆ†äº«é“¾æ¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ†äº«å¡ç‰‡æ¨¡æ€æ¡† -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">åˆ›æ„åˆ†äº«</div>
                <button class="close-btn" onclick="closeShareModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <div class="share-card-container">
                    <div class="share-card" id="shareCard">
                        <div class="share-card-header">
                            <div class="share-card-logo">ThinkCraft</div>
                            <div class="share-card-badge">AI åˆ†æ</div>
                        </div>
                        <div class="share-card-main">
                            <div class="share-card-label">æˆ‘çš„åˆ›æ„</div>
                            <div class="share-card-idea" id="shareIdeaTitle">åˆ›æ„éªŒè¯å·¥å…·</div>
                            <div class="share-card-tags">
                                <div class="share-tag" id="shareTag1">åˆ›ä¸šæƒ³æ³•</div>
                                <div class="share-tag" id="shareTag2">AIå·¥å…·</div>
                            </div>
                        </div>
                        <div class="share-card-stats">
                            <div class="share-stat">
                                <div>
                                    <div class="share-stat-value">85</div>
                                    <div class="share-stat-label">å¯è¡Œæ€§</div>
                                </div>
                            </div>
                            <div class="share-stat">
                                <div>
                                    <div class="share-stat-value">78</div>
                                    <div class="share-stat-label">åˆ›æ–°æ€§</div>
                                </div>
                            </div>
                            <div class="share-stat">
                                <div>
                                    <div class="share-stat-value">92</div>
                                    <div class="share-stat-label">å¸‚åœºæ½œåŠ›</div>
                                </div>
                            </div>
                        </div>
                        <div class="share-card-footer">
                            <div class="share-card-footer-text">
                                <div class="share-card-footer-label">ç”Ÿæˆæ—¶é—´</div>
                                <div class="share-cta" id="shareDate">2026-01-09</div>
                            </div>
                            <div class="share-qr"></div>
                        </div>
                    </div>
                    <div class="share-actions">
                        <button class="share-action-btn secondary" onclick="downloadCard()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            ä¸‹è½½å›¾ç‰‡
                        </button>
                        <button class="share-action-btn primary" onclick="copyShareText()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            å¤åˆ¶æ–‡æ¡ˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°æ‰‹å¼•å¯¼ -->
    <div class="onboarding-overlay" id="onboardingOverlay" style="display: none;">
        <div class="onboarding-backdrop"></div>
        <div class="onboarding-highlight" id="onboardingHighlight"></div>
        <div class="onboarding-tooltip" id="onboardingTooltip">
            <div class="onboarding-step" id="onboardingStep">1 / 1</div>
            <div class="onboarding-title" id="onboardingTitle"></div>
            <div class="onboarding-desc" id="onboardingDesc"></div>
            <div class="onboarding-actions">
                <button class="btn-secondary" id="onboardingSkip">è·³è¿‡</button>
                <button class="btn-secondary" id="onboardingPrev">ä¸Šä¸€æ­¥</button>
                <button class="btn-primary" id="onboardingNext">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>

    <!-- ç« èŠ‚é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal" id="chapterSelectionModal">
        <div class="modal-content chapter-selection">
            <div class="modal-header">
                <div class="modal-title">é€‰æ‹©éœ€è¦ç”Ÿæˆçš„ç« èŠ‚</div>
                <button class="close-btn" onclick="closeChapterSelection()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <p class="tip">æ ¸å¿ƒç« èŠ‚å°†è‡ªåŠ¨ç”Ÿæˆï¼Œæ‚¨å¯ä»¥é€‰æ‹©éœ€è¦æ·±å…¥åˆ†æçš„å…¶ä»–ç« èŠ‚</p>

                <div id="chapterList">
                    <!-- ç« èŠ‚åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="modal-footer">
                <p id="chapterStats" style="color: var(--text-secondary); font-size: 14px;">
                    å·²é€‰ <strong style="color: var(--primary);">5</strong> ä¸ªç« èŠ‚ï¼Œé¢„è®¡ç”¨æ—¶ <strong style="color: var(--primary);">2åˆ†é’Ÿ</strong>
                </p>
                <button class="btn-primary" onclick="startGeneration()">å¼€å§‹ç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <!-- Agentè¿›åº¦å±•ç¤ºæ¨¡æ€æ¡† -->
    <div class="modal" id="agentProgressModal">
        <div class="modal-content agent-progress">
            <div class="modal-header">
                <div class="modal-title">ğŸ¤– AIä¸“å®¶å›¢é˜Ÿæ­£åœ¨å·¥ä½œä¸­...</div>
                <button class="close-btn" onclick="closeAgentProgress()" aria-label="å…³é—­">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- æ•´ä½“è¿›åº¦ -->
                <div class="overall-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                    </div>
                    <p id="progressText">å‡†å¤‡å¼€å§‹ç”Ÿæˆ...</p>
                </div>

                <!-- Agentå·¥ä½œåˆ—è¡¨ -->
                <div class="agent-list" id="agentList">
                    <!-- Agenté¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <button class="btn-secondary" onclick="cancelGeneration()" style="width: 100%; margin-top: 16px;">å–æ¶ˆç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <!-- å•†ä¸šè®¡åˆ’ä¹¦/äº§å“ç«‹é¡¹æŠ¥å‘Šæ¨¡æ€æ¡† -->
    <div class="modal" id="businessReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <div class="modal-title" id="businessReportTitle">å•†ä¸šè®¡åˆ’ä¹¦</div>
                </div>
                <button class="close-btn" onclick="closeBusinessReport()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body" id="businessReportContent">
                <!-- æŠ¥å‘Šå†…å®¹å°†åŠ¨æ€æ’å…¥ -->
            </div>

            <div class="modal-footer">
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn-secondary" onclick="adjustBusinessReportChapters()">è°ƒæ•´ç« èŠ‚</button>
                    <button class="btn-secondary" onclick="regenerateBusinessReport()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
                    <button class="btn-secondary" onclick="exportBusinessReport()">å¯¼å‡ºPDF</button>
                    <button class="btn-primary" id="businessReportShareBtn" onclick="shareBusinessReport()">åˆ†äº«æŠ¥å‘Š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- çŸ¥è¯†åº“æ¨¡æ€æ¡† -->
    <!-- çŸ¥è¯†åº“Modal - æ–°ç‰ˆåŒæ å¸ƒå±€ -->
    <div class="modal" id="knowledgeModal">
        <div class="modal-content knowledge-modal-wide">
            <!-- Header -->
            <div class="modal-header" style="border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                <div class="knowledge-breadcrumb" id="knowledgeBreadcrumb">
                    <span>ğŸ“š å…¨å±€çŸ¥è¯†åº“</span>
                </div>
                <button class="close-btn" onclick="closeKnowledgeBase()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- ä¸»ä½“ï¼šåŒæ å¸ƒå±€ -->
            <div style="display: flex; flex: 1; overflow: hidden;">
                <!-- å·¦ä¾§è¾¹æ ï¼šç»„ç»‡æ ‘ -->
                <div class="knowledge-sidebar">
                    <!-- ç»„ç»‡æ–¹å¼åˆ‡æ¢å™¨ -->
                    <div class="knowledge-org-switcher">
                        <button class="active" data-org="byType" onclick="switchKnowledgeOrganization('byType')">æŒ‰ç±»å‹</button>
                        <button data-org="byTimeline" onclick="switchKnowledgeOrganization('byTimeline')">æ—¶é—´çº¿</button>
                        <button data-org="byTags" onclick="switchKnowledgeOrganization('byTags')">æ ‡ç­¾</button>
                    </div>

                    <!-- åŠ¨æ€ç»„ç»‡æ ‘ -->
                    <div id="knowledgeModalOrgTree" class="knowledge-org-tree">
                        <!-- ç”±JSåŠ¨æ€æ¸²æŸ“ -->
                    </div>
                </div>

                <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
                <div class="knowledge-main">
                    <!-- å·¥å…·æ  -->
                    <div class="knowledge-toolbar">
                        <input type="text" id="knowledgeModalSearch" placeholder="æœç´¢çŸ¥è¯†..." oninput="onKnowledgeSearch(this.value)">
                        <select id="knowledgeModalTypeFilter" onchange="onKnowledgeTypeFilter(this.value)">
                            <option value="">æ‰€æœ‰ç±»å‹</option>
                            <option value="prd">PRD</option>
                            <option value="tech">æŠ€æœ¯æ–¹æ¡ˆ</option>
                            <option value="analysis">å¸‚åœºåˆ†æ</option>
                            <option value="research">ç”¨æˆ·è°ƒç ”</option>
                            <option value="design">è®¾è®¡ç¨¿</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                        <button class="btn-primary" onclick="createKnowledge()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            æ–°å»º
                        </button>
                    </div>

                    <!-- çŸ¥è¯†å¡ç‰‡åˆ—è¡¨ -->
                    <div id="knowledgeModalList" class="knowledge-grid">
                        <!-- ç”±JSåŠ¨æ€æ¸²æŸ“ -->
                    </div>

                    <!-- ç©ºçŠ¶æ€ -->
                    <div id="knowledgeModalEmpty" class="empty-state" style="display: none;">
                        <div class="empty-icon">ğŸ“š</div>
                        <div class="empty-text">æš‚æ— çŸ¥è¯†æ²‰æ·€</div>
                        <button class="btn-primary" onclick="createKnowledge()">åˆ›å»ºç¬¬ä¸€ä¸ª</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="settingsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title">è®¾ç½®</div>
                <button class="close-btn" onclick="closeSettings()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- å¤–è§‚éƒ¨åˆ†å·²éšè— -->
                <!-- <div class="settings-section">
                    <div class="settings-section-title">å¤–è§‚</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">æš—è‰²æ¨¡å¼</div>
                            <div class="settings-item-desc">åˆ‡æ¢ä¸ºæ·±è‰²ä¸»é¢˜</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div> -->

                <div class="settings-section">
                    <div class="settings-section-title">æ•°æ®ç®¡ç†</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">ä¿å­˜å†å²è®°å½•</div>
                            <div class="settings-item-desc">è‡ªåŠ¨ä¿å­˜å¯¹è¯åˆ°æœ¬åœ°</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="saveHistoryToggle" checked onchange="toggleSaveHistory()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">åŠŸèƒ½</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">æ•°å­—å‘˜å·¥å›¢é˜Ÿ <span class="beta-badge">beta</span></div>
                            <div class="settings-item-desc">å¯ç”¨AIå›¢é˜Ÿåä½œåŠŸèƒ½ï¼Œå¯åœ¨ä¾§è¾¹æ åˆ‡æ¢æŸ¥çœ‹</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableTeamToggle" onchange="toggleTeamFeature(this)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">å…³äº</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">ThinkCraft v2.0</div>
                            <div class="settings-item-desc">AIæ€ç»´åŠ©æ‰‹ Â· å°†çµæ„Ÿè½¬åŒ–ä¸ºæ´å¯Ÿ</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div style="margin-top: 0;">
                        <button class="danger-btn" onclick="clearAllHistory()">æ¸…é™¤æ‰€æœ‰å†å²è®°å½•</button>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="logout-btn" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ä¸Šæ»‘è®¾ç½®é¢æ¿ï¼ˆç§»åŠ¨ç«¯ä¸“ç”¨ï¼‰ -->
    <div class="bottom-sheet" id="bottomSettingsSheet">
        <div class="bottom-sheet-overlay" onclick="closeBottomSettings()"></div>
        <div class="bottom-sheet-content">
            <!-- æ‹–åŠ¨æŒ‡ç¤ºæ¡ -->
            <div class="bottom-sheet-handle"></div>

            <!-- è®¾ç½®å†…å®¹ -->
            <div class="bottom-sheet-header">
                <h3>è®¾ç½®</h3>
                <button class="close-btn" onclick="closeBottomSettings()" aria-label="å…³é—­">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="bottom-sheet-body">
                <!-- ç”¨æˆ·ä¿¡æ¯ -->
                <div class="settings-section">
                    <div class="user-profile">
                        <div class="user-avatar-large">
                            <svg width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                            </svg>
                        </div>
                        <div class="user-profile-info">
                            <div class="user-profile-name">ThinkCraft ç”¨æˆ·</div>
                            <div class="user-profile-desc">æ¢ç´¢æ€ç»´çš„è¾¹ç•Œ</div>
                        </div>
                    </div>
                </div>

                <!-- ä¸»é¢˜è®¾ç½®å·²éšè— -->
                <!-- <div class="settings-section">
                    <div class="settings-section-title">å¤–è§‚</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">æ·±è‰²æ¨¡å¼</div>
                            <div class="settings-item-desc">åˆ‡æ¢ä¸ºæ·±è‰²ä¸»é¢˜</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle2" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div> -->

                <!-- æ•°æ®ç®¡ç† -->
                <div class="settings-section">
                    <div class="settings-section-title">æ•°æ®ç®¡ç†</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">ä¿å­˜å†å²è®°å½•</div>
                            <div class="settings-item-desc">è‡ªåŠ¨ä¿å­˜å¯¹è¯åˆ°æœ¬åœ°</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="saveHistoryToggle2" checked onchange="toggleSaveHistory()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- åŠŸèƒ½ -->
                <div class="settings-section">
                    <div class="settings-section-title">åŠŸèƒ½</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">æ•°å­—å‘˜å·¥å›¢é˜Ÿ <span class="beta-badge">beta</span></div>
                            <div class="settings-item-desc">å¯ç”¨AIå›¢é˜Ÿåä½œåŠŸèƒ½ï¼Œå¯åœ¨ä¾§è¾¹æ åˆ‡æ¢æŸ¥çœ‹</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableTeamToggle2" onchange="toggleTeamFeature(this)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- å…³äº -->
                <div class="settings-section">
                    <div class="settings-section-title">å…³äº</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">ThinkCraft v2.0</div>
                            <div class="settings-item-desc">AIæ€ç»´åŠ©æ‰‹ Â· å°†çµæ„Ÿè½¬åŒ–ä¸ºæ´å¯Ÿ</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div style="margin-top: 0;">
                        <button class="danger-btn" onclick="clearAllHistory()">æ¸…é™¤æ‰€æœ‰å†å²è®°å½•</button>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="logout-btn" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡¹ç›®è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="projectModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title" id="projectModalTitle">é¡¹ç›®è¯¦æƒ…</div>
                <button class="close-btn" onclick="closeProjectModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- é¡¹ç›®æ¦‚è§ˆ -->
                <div class="project-overview" id="projectOverview">
                    <div class="overview-card">
                        <div class="overview-label">çŠ¶æ€</div>
                        <div class="overview-value" id="projectStatus" style="font-size: 16px;">-</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-label">å›¢é˜Ÿæˆå‘˜</div>
                        <div class="overview-value" id="projectMemberCount">0</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-label">åˆ›æ„æ•°</div>
                        <div class="overview-value" id="projectIdeaCount">0</div>
                    </div>
                </div>

                <!-- å›¢é˜Ÿæˆå‘˜ -->
                <div class="project-section">
                    <div class="project-section-header">
                        <h3>ğŸ‘¥ å›¢é˜Ÿæˆå‘˜</h3>
                        <button class="btn-primary" onclick="showAddMember()" style="padding: 8px 16px; font-size: 14px;">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 4px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            æ·»åŠ æˆå‘˜
                        </button>
                    </div>
                    <div class="project-members-grid" id="projectMembersList"></div>
                </div>

                <!-- å…³è”åˆ›æ„ -->
                <div class="project-section">
                    <div class="project-section-header">
                        <h3>ğŸ’¡ å…³è”åˆ›æ„</h3>
                    </div>
                    <div class="project-ideas-grid" id="projectIdeasList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ æˆå‘˜æ¨¡æ€æ¡†ï¼ˆæ•°å­—å‘˜å·¥é›‡ä½£ï¼‰-->
    <div class="modal" id="addMemberModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">æ·»åŠ å›¢é˜Ÿæˆå‘˜</div>
                <button class="close-btn" onclick="closeAddMember()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Tabåˆ‡æ¢ -->
                <div class="report-tabs" style="margin-bottom: 24px;">
                    <button class="report-tab active" onclick="switchAddMemberTab('market')">é›‡ä½£å¸‚åœº</button>
                    <button class="report-tab" onclick="switchAddMemberTab('hired')">å·²é›‡ä½£</button>
                </div>

                <!-- é›‡ä½£å¸‚åœºTab -->
                <div id="addMemberMarketTab" class="add-member-tab-content">
                    <div style="text-align: center; padding: 16px; background: #eff6ff; border-radius: 8px; margin-bottom: 24px;">
                        <p style="font-size: 14px; color: #1e40af; margin: 0;">ğŸ’¼ é€‰æ‹©æ•°å­—å‘˜å·¥åŠ å…¥é¡¹ç›®å›¢é˜Ÿï¼Œä»–ä»¬å°†ä¸ºé¡¹ç›®æä¾›ä¸“ä¸šæ”¯æŒ</p>
                    </div>
                    <!-- å‘˜å·¥åˆ—è¡¨ -->
                    <div class="agent-market-grid" id="projectAgentList"></div>
                </div>

                <!-- å·²é›‡ä½£Tab -->
                <div id="addMemberHiredTab" class="add-member-tab-content" style="display: none;">
                    <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px; margin-bottom: 24px;">
                        <p style="font-size: 14px; color: #166534; margin: 0;">ğŸ‘¥ å½“å‰é¡¹ç›®å·²é›‡ä½£çš„æ•°å­—å‘˜å·¥ï¼Œç‚¹å‡»è§£é›‡å¯ä»¥ç§»é™¤æˆå‘˜</p>
                    </div>
                    <!-- å·²é›‡ä½£å‘˜å·¥åˆ—è¡¨ -->
                    <div class="agent-market-grid" id="projectHiredAgentList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- å‘˜å·¥å¸‚åœºæ¨¡æ€æ¡† -->
    <div class="modal" id="agentMarketModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">ğŸª æ•°å­—å‘˜å·¥å¸‚åœº</div>
                <button class="close-btn" onclick="closeAgentMarket()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Tabåˆ‡æ¢ -->
                <div class="report-tabs" style="margin-bottom: 24px;">
                    <button class="report-tab active" onclick="switchMarketTab('market')">å¯é›‡ä½£</button>
                    <button class="report-tab" onclick="switchMarketTab('hired')">å·²é›‡ä½£</button>
                </div>

                <!-- å¯é›‡ä½£å‘˜å·¥åˆ—è¡¨ -->
                <div id="marketTab" class="market-tab-content">
                    <div id="agentMarketGrid" class="agent-market-grid"></div>
                </div>

                <!-- å·²é›‡ä½£å‘˜å·¥åˆ—è¡¨ -->
                <div id="hiredTab" class="market-tab-content" style="display: none;">
                    <div id="hiredAgentsGrid" class="agent-market-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Legacy boot (split for maintainability) -->
    <script src="/frontend/js/boot/legacy/index-app-state.js"></script>

    <!-- å®Œæ•´ StateManagerï¼ˆä¾èµ– window.stateï¼‰ -->
    <script src="/frontend/js/core/state-manager.js"></script>

    <!-- æ ¸å¿ƒæ¨¡å— -->
    <script src="/frontend/js/core/api-client.js"></script>
    <script src="/frontend/js/core/storage-manager.js"></script>

    <!-- å·¥å…·å‡½æ•° -->
    <script src="/frontend/js/utils/logger.js?v=20260131-fix3"></script>
    <script src="/frontend/js/utils/format.js?v=20260131-fix"></script>
    <script src="/frontend/js/utils/dom.js?v=20260131-fix"></script>
    <script src="/frontend/js/utils/icons.js?v=20260131-fix"></script>
    <script src="/frontend/js/utils/app-helpers.js"></script>
    <script src="/frontend/js/utils/global-bridges.js"></script>

    <!-- Toastæç¤ºå·¥å…· -->
    <script src="/frontend/js/utils/toast.js?v=20260201-toast"></script>

    <!-- å¯¼å‡ºéªŒè¯å·¥å…· -->
    <script src="/frontend/js/utils/export-validator.js?v=20260201-export"></script>

    <!-- è°ƒè¯•å·¥å…·ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ -->
    <script src="/frontend/js/utils/debug-progress.js?v=20260201-debug"></script>

    <!-- ç»„ä»¶æ¨¡å— -->
    <script src="/frontend/js/components/modal-manager.js"></script>
    <script src="/frontend/js/components/agent-progress.js"></script>
    <script src="/frontend/js/components/markdown-renderer.js"></script>

    <!-- æŠ¥å‘ŠçŠ¶æ€ç®¡ç†å™¨ï¼ˆå¿…é¡»åœ¨èŠå¤©æ¨¡å—ä¹‹å‰åŠ è½½ï¼‰ -->
    <script src="/frontend/js/modules/report/report-status-manager.js"></script>

    <!-- èŠå¤©æ¨¡å— -->
    <script src="/frontend/js/modules/chat/typing-effect.js"></script>
    <script src="/frontend/js/modules/chat/message-handler.js"></script>
    <script src="/frontend/js/modules/chat/chat-list.js"></script>
    <script src="/frontend/js/modules/chat/chat-manager.js"></script>

    <!-- ==================== æ ¸å¿ƒæ¨¡å—ï¼ˆç«‹å³åŠ è½½ï¼‰ ==================== -->
    <!-- è¾“å…¥å¤„ç†å™¨ï¼ˆé«˜ä¼˜å…ˆçº§ï¼šç”¨æˆ·å¯èƒ½ç«‹å³ä½¿ç”¨ï¼‰ -->
    <script src="/frontend/js/modules/input-handler.js"></script>

    <!-- UIæ§åˆ¶å™¨ï¼ˆé«˜ä¼˜å…ˆçº§ï¼šç•Œé¢äº¤äº’ï¼‰ -->
    <script src="/frontend/js/modules/ui-controller.js?v=20260201-fix"></script>

    <!-- ==================== å¯åŠ¨æ–‡ä»¶ ==================== -->
    <script src="/frontend/js/app-boot.js?v=20260131-lazy"></script>
    <script src="/frontend/js/boot/init.js?v=20260131-lazy"></script>

    <!-- ==================== ä½ä¼˜å…ˆçº§æ¨¡å—ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰ ==================== -->
    <!-- æŠ¥å‘Šæ¨¡å—ï¼ˆç”¨æˆ·ç‚¹å‡»"ç”ŸæˆæŠ¥å‘Š"æ—¶æ‰éœ€è¦ï¼‰ -->
    <script defer src="/frontend/js/modules/report/report-viewer.js"></script>
    <script defer src="/frontend/js/modules/report/report-generator.js?v=20260201-fix"></script>
    <script defer src="/frontend/js/modules/report/share-card.js?v=20260201-fix"></script>

    <!-- é¡¹ç›®ç®¡ç†ï¼ˆç”¨æˆ·ç‚¹å‡»"é¡¹ç›®"æ—¶æ‰éœ€è¦ï¼‰ -->
    <script defer src="/frontend/js/modules/project-manager.js?v=20260131-fix2"></script>

    <!-- çŸ¥è¯†åº“ï¼ˆç”¨æˆ·ç‚¹å‡»"çŸ¥è¯†åº“"æ—¶æ‰éœ€è¦ï¼‰ -->
    <script defer src="/frontend/js/modules/knowledge-base.js?v=20260201-fix"></script>

    <!-- Agentç³»ç»Ÿï¼ˆç”¨æˆ·ç‚¹å‡»"Agentç®¡ç†"æ—¶æ‰éœ€è¦ï¼‰ -->
    <script defer src="/frontend/js/modules/agent-collaboration.js?v=20260131-4"></script>

    <!-- å•†ä¸šè®¡åˆ’ä¹¦ï¼ˆç”¨æˆ·ç‚¹å‡»"ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦"æ—¶æ‰éœ€è¦ï¼‰ -->
    <script defer src="/frontend/js/modules/business-plan-generator.js?v=20260131-fix2"></script>

    <!-- å·¥ä½œæµæ‰§è¡Œå™¨ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰ -->
    <script defer src="/frontend/js/modules/workflow-executor.js"></script>

    <!-- é¢„è§ˆé¢æ¿ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰ -->
    <script defer src="/frontend/js/modules/preview-panel.js"></script>

    <!-- å›¢é˜Ÿåä½œï¼ˆæŒ‰éœ€åŠ è½½ï¼‰ -->
    <script defer src="/frontend/js/modules/team/team-collaboration.js?v=20260131-fix2"></script>

    <!-- è®¾ç½®ç®¡ç†ï¼ˆç”¨æˆ·ç‚¹å‡»"è®¾ç½®"æ—¶æ‰éœ€è¦ï¼‰ -->
    <script defer src="/frontend/js/modules/settings/settings-manager.js?v=20260131-fix2"></script>

    <!-- æ–°æ‰‹å¼•å¯¼ï¼ˆæ¡ä»¶åŠ è½½ï¼šä»…é¦–æ¬¡è®¿é—®ï¼‰ -->
    <script defer src="/frontend/js/modules/onboarding/onboarding-manager.js?v=20260131-fix2"></script>

    <!-- æŒ‰é’®ç®¡ç†å™¨ -->
    <script defer src="/frontend/js/modules/state/report-button-manager.js?v=20260201-fix"></script>
</body>
</html>
