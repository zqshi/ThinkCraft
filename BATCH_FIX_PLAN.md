# 批量修复计划 - 2026-01-18

## 需要修复的问题列表

### 1. ⚠️ 高优先级：左侧对话列表不显示新对话
**问题：** 发送消息后，左侧对话列表不显示新创建的对话
**根本原因：** `saveCurrentChat()` 只保存到 localStorage，没有调用后端API创建对话
**解决方案：** 修改 `saveCurrentChat()` 为 async 函数，调用 `POST /api/conversations` 创建对话

### 2. ⚠️ 高优先级：Markdown渲染问题（显示****原始语法）
**问题：** 对话窗口显示Markdown原始语法（如****），而不是渲染后的效果
**根本原因：** `addMessage()` 和 `typeWriter()` 直接使用 `textContent`，不支持HTML
**解决方案：**
- 安装 marked.js 库解析Markdown
- 修改消息渲染逻辑使用 `innerHTML`
- 添加代码高亮支持

### 3. 中等优先级：中文输入法Enter键问题
**问题：** 中文输入法状态下，第一次Enter直接发送消息（应该是选词）
**根本原因：** 没有监听 `compositionstart` 和 `compositionend` 事件
**解决方案：** 添加输入法状态tracking

### 4. 中等优先级：支持打断助手回复
**问题：** 助手回复时，用户无法发送新消息打断
**根本原因：**
- `state.isTyping` 和 `state.isLoading` 阻止发送
- 没有 AbortController 取消正在进行的请求
**解决方案：**
- 移除发送消息时的 `state.isTyping` 检查
- 添加 AbortController 取消机制
- 用户发送新消息时取消旧请求

### 5. 低优先级：退出登录没有反应
**问题：** 点击设置中的退出登录按钮没有反应
**状态：** 之前已修复（暴露函数到window），需要验证

### 6. 低优先级：数字员工团队开关默认关闭
**问题：** 初始登录时，数字员工团队开关应该默认关闭
**解决方案：** 修改默认设置

---

## 修复顺序

1. **先修复对话列表** - 否则基本功能不可用
2. **添加Markdown渲染** - 用户体验关键
3. **修复输入法问题** - 影响中文用户
4. **支持打断回复** - 用户体验提升
5. **验证退出登录** - 确认是否已修复
6. **关闭默认开关** - 配置调整
