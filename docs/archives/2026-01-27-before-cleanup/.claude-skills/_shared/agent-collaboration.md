# Agent 协作设计规范（共享）

> **重要提示**：本文档定义了所有产品开发体系共享的 Agent 协作规范，包括 Agent 无状态调用的本质、标准 Prompt 结构模板和强制自检清单。协调者在调用任何 Agent 前必须阅读本文档。

---

## 0. 术语表

| 术语               | 定义                        | 说明                                                |
| ------------------ | --------------------------- | --------------------------------------------------- |
| **协调者**         | Orchestrator Agent          | 产品开发流程的主调度 Agent                          |
| **Agent**          | 被调用的专业 Agent          | 如 product-manager-agent、ui-ux-designer-agent 等   |
| **无状态调用**     | 每次调用独立，无历史记忆    | Agent 只能看到当前 prompt，无法访问历史对话         |
| **信息透传**       | 完整传递，不做任何加工      | 禁止摘要、改写、删减、归纳用户需求或 Agent 输出     |
| **职责边界**       | 各角色明确的任务范围        | 协调者不替 Agent 做专业决策，Agent 不执行协调者职责 |
| **5W1H**           | Who/Where/When/What/Why/How | 调用前自检模型，确保信息完整性                      |
| **失忆症患者测试** | 极端化思维模型              | 假设 Agent 只能看到当前 prompt，无任何历史记忆      |

---

## 1. Agent 无状态调用本质

### 核心认知

- **无状态调用**：Agent 每次调用都是独立的、无历史记忆的，只能看到单次 prompt
- **单次输入-输出**：Agent 无法"对话"，只能完成"接收 prompt → 处理 → 输出结果"
- **信息孤岛**：Agent 看不到历史对话、其他 Agent 的输出、整体流程上下文

### 协调者职责

- **状态管理**：负责多轮调用的状态维护和流程控制
- **信息传递**：负责信息在 Agent 间、Agent 与用户间的完整、准确传递
- **流程协调**：决定调用哪个 Agent、何时调用、传递什么信息
- **质量验证**：验证 Agent 输出的合规性和质量
- **职责边界**：不干预 Agent 的专业决策

### 信息对称原则

- Agent 需要的所有信息必须在 prompt 中显式提供
- Agent 需要知道自己在整体流程中的位置和作用
- Agent 需要知道自己的输出会被如何使用
- Agent 需要知道任务的明确边界（做什么、不做什么）

---

## 2. 标准 Prompt 结构模板

### 【协作上下文】

#### 您在流程中的位置

{简要说明当前在整体流程中的位置，1-2 句话}

#### 本次调用的目的

{明确说明为什么调用您，期望您做什么，1-2 句话}

#### 调用模式说明

**如果是单次任务**：

- 本次调用完成任务后即结束
- 您的输出将被：{如何使用，例如"完整呈现给用户"、"作为下一阶段的输入文档"}
- 后续流程：{简要说明后续由协调者如何处理}

**如果是多轮任务的第 N 轮**：

- 这是第 {N} 轮调用
- 上一轮您做了：{上轮任务摘要}
- 本轮您需要做：{本轮任务摘要}
- 下一轮调用的触发条件：{什么情况下会再次调用您}
- 下一轮会提供的信息：{列出会提供的信息类型}

#### 边界约束

- ✅ 您需要做：{明确的任务范围}
- ❌ 您无需做：{明确排除的行为，如"无需等待用户回复"、"无需调用其他 Agent"}
- ⚠️ 特别注意：{容易混淆的点}

---

### 【任务依赖信息】

#### 用户原始输入（如适用）

{完整内容，一字不差}

#### 依赖文件（如适用）

**文件 1**: {路径}
**说明**: 请使用 Read 工具读取该文件的完整内容

**文件 2**: {路径}（如有多个文件）
**说明**: 请使用 Read 工具读取该文件的完整内容

#### 历史交互（如适用）

{完整的历史问答、澄清记录等}

---

### 【本次任务】

{具体的、可执行的、边界清晰的任务描述}

---

### 【输出要求】

- **输出类型**: [问题列表 | 分析报告 | 文档 | 决策判断]
- **输出格式**: {格式要求}
- **文件要求**（如生成文档）:
  - 命名规范: {规范}
  - 存放路径: {路径}
  - 版本号规则: 使用时间戳 YYYYMMDDHHmmss
- **合规要求**: 严格执行 templates.md#文档元信息与合规自检 中规定的流程

---

## 3. 调用前强制自检（5W1H）

### Who（谁）

- [ ] 是否明确告知 Agent 它是谁？
- [ ] 职责边界是否清晰？

### Where（哪里）

- [ ] 是否说明当前在整体流程的哪个阶段？
- [ ] 是否说明这是第几次调用？

### What（什么）

- [ ] 任务描述是否具体、可执行、边界清晰？
- [ ] 是否避免了"与用户对话"、"等待用户回复"等不可能完成的表述？

### Why（为什么）

- [ ] 是否说明为什么调用这个 Agent？
- [ ] 是否说明输出将如何被使用？

### When（何时）

- [ ] 是否说明这是第几次调用？
- [ ] 上一轮做了什么？

### How（如何）

- [ ] 是否提供了完成任务所需的全部信息？
- [ ] 依赖文件路径是否明确？
- [ ] 用户原始需求是否完整复制（一字不差）？

---

## 4. 信息透传强制规范

### 场景1：Agent输出→用户呈现

**强制要求**：原封不动地将 Agent 的完整输出呈现给用户。

**禁止行为**：

- ❌ 使用"Agent已经..."、"Agent提出了X个问题"等概括性描述
- ❌ 使用"涵盖"、"包括"、"主要内容"等归纳总结词汇
- ❌ 对Agent输出进行改写、精简、重新组织

**正确做法**：

```
收到 {agent_name} 的完整输出：

[Agent的完整原始输出，一字不改]
```

### 场景2：用户需求→Agent调用

**强制要求**：完整复制用户需求到 Prompt 的【用户原始输入】章节。

**禁止行为**：

- ❌ 使用"用户希望..."、"用户需要..."等转述
- ❌ 使用"详见上文"、"如前所述"等省略表述
- ❌ 对用户需求进行归纳、总结、改写

**正确做法**：

```
## 【任务依赖信息】

### 用户原始输入
{用户的完整原始需求，一字不差地复制}
```

---

## 5. 职责边界与防越俎代庖

### 核心行为约束

**协调者禁止行为**：

- ❌ 不替 Agent 决定"怎么做"（方法论、维度、框架、章节）
- ❌ 不在 Prompt 中列出"应该包含的内容清单/维度清单/章节清单"
- ❌ 不对 Agent 的专业判断进行干预

**Agent 禁止行为**：

- ❌ 不调用其他 Agent（这是协调者的职责）
- ❌ 不等待用户回复（Agent 是单次调用，无法对话）
- ❌ 不假设历史信息（所有必要信息都在 Prompt 中）

### 信任建立原则

**信任 Agent 的专业能力**：

- ✅ 相信 Agent 会运用专业方法论完成任务
- ✅ 相信 Agent 会自主决定内容结构和组织方式
- ✅ 相信 Agent 会根据任务目标选择合适的分析维度

**提供必要的约束**：

- ✅ 可提及可用的方法论选项（如"可使用 SWOT、JTBD 等方法论"）
- ✅ 可说明输出类型和格式要求
- ✅ 可说明任务边界和禁止事项

---

## 6. 调用前违规模式扫描清单

### 模式A：指令性列表

**违规模式**：`(应该|应当|需要|必须).{0,20}(包含|涵盖|分为).{0,10}[:：]`

- 违规："应该包含以下内容："
- 处理：删除列表，替换为"请运用你的专业方法论完成任务"

### 模式B：结构预设

**违规模式**：`(章节结构|内容结构|输出结构|文档结构).{0,10}(为|是|包括)`

- 违规："章节结构为..."
- 处理：删除整个结构描述段落

### 模式C：维度枚举

**违规模式**：`(维度|方面|角度).{0,10}[:：]\s*\n\s*[-*\d]`

- 违规："从以下维度分析：\n- xxx"
- 处理：删除列表部分

### 模式D：按照XX组织

**违规模式**：`按照.{0,20}(顺序|结构|方式|逻辑)`

- 违规："按照市场-竞品-用户的顺序"
- 处理：删除整句

### 模式E：关注/注意类暗示

**违规模式**：`(重点|特别|优先|需要|请)(关注|注意|考虑|聚焦).{0,10}[:：]\s*\n\s*[-*\d]`

- 违规："重点关注：\n- xxx"
- 处理：删除列表部分

---

## 7. Agent 输出异常检测规则

### 角色混淆检测

扫描 Agent 输出是否包含：

- "我应该调用"、"我作为协调者"
- "我需要等待用户回复"
- "让我直接与用户沟通"

如发现，在 Prompt 中明确：输出对象是协调者、使用报告式语言、Agent 不直接与用户对话。

---

## 8. 核心协作原则

- **无状态调用**：Agent 每次调用独立，无历史记忆，需完整传递上下文
- **信息透传**：禁止摘要、改写、删减，必须完整传递
- **职责边界**：不替 Agent 做决策，不干预专业判断
- **质量验证**：验证文档合规性，失败时要求生成新版本
