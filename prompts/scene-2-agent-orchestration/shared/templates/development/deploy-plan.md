# 部署方案模板

> 部署架构、环境配置、发布流程

---

## 模板元信息

**Template**: 部署方案模板
**Version**: v1.0
**适用场景**: 开发阶段 - 部署规划
**输出文件命名**: `部署方案-{产品名称}-v{YYYYMMDDHHmmss}.md`

---

## 模板结构

```markdown
# 部署方案

---

**Template**: 部署方案模板
**Version**: v{YYYYMMDDHHmmss}
**Changelog**: {时间} - {修改人} - {修改原因摘要}

---

## 1. 文档信息

### 1.1 文档属性

- **产品名称**: [产品名称]
- **部署版本**: [版本号]
- **文档版本**: v{YYYYMMDDHHmmss}
- **创建日期**: {YYYY-MM-DD}
- **创建人**: [创建人]
- **审核人**: [审核人]

### 1.2 依赖文档

- **战略设计文档**: [文档路径] - v{YYYYMMDDHHmmss}
- **测试报告**: [文档路径] - v{YYYYMMDDHHmmss}

---

## 2. 部署概述

### 2.1 部署目标

[说明本次部署要达成的目标]

### 2.2 部署范围

**包含范围**:
- [范围1]
- [范围2]
- [范围3]

**不包含范围**:
- [范围1]
- [范围2]

### 2.3 部署时间

- **计划部署时间**: {YYYY-MM-DD HH:mm:ss}
- **预计完成时间**: {YYYY-MM-DD HH:mm:ss}
- **部署窗口**: [时长]

---

## 3. 环境规划

### 3.1 环境列表

| 环境名称 | 用途 | 访问地址 | 配置 | 负责人 |
|---------|------|---------|------|--------|
| [环境名称] | [用途] | [URL] | [配置说明] | [姓名] |

### 3.2 环境配置

#### 开发环境

- **服务器配置**: [配置]
- **数据库配置**: [配置]
- **中间件配置**: [配置]
- **域名**: [域名]

#### 测试环境

- **服务器配置**: [配置]
- **数据库配置**: [配置]
- **中间件配置**: [配置]
- **域名**: [域名]

#### 预发布环境

- **服务器配置**: [配置]
- **数据库配置**: [配置]
- **中间件配置**: [配置]
- **域名**: [域名]

#### 生产环境

- **服务器配置**: [配置]
- **数据库配置**: [配置]
- **中间件配置**: [配置]
- **域名**: [域名]

### 3.3 环境变量

| 变量名 | 开发环境 | 测试环境 | 预发布环境 | 生产环境 | 说明 |
|--------|---------|---------|-----------|---------|------|
| [变量名] | [值] | [值] | [值] | [值] | [说明] |

---

## 4. 部署架构

### 4.1 架构拓扑图

```
[绘制部署架构拓扑图]
```

### 4.2 服务器规划

| 服务器角色 | 数量 | 配置 | 操作系统 | 部署服务 |
|-----------|------|------|---------|---------|
| [角色] | [数量] | [配置] | [系统] | [服务列表] |

### 4.3 网络规划

**网络拓扑**:
- **公网**: [配置]
- **内网**: [配置]
- **VPC**: [配置]

**安全组规则**:
| 规则名称 | 协议 | 端口 | 源地址 | 目标地址 | 说明 |
|---------|------|------|--------|---------|------|
| [规则名称] | [协议] | [端口] | [源] | [目标] | [说明] |

### 4.4 负载均衡

- **负载均衡器**: [类型]
- **负载均衡算法**: [算法]
- **健康检查**: [配置]
- **会话保持**: [配置]

---

## 5. 容器化方案

### 5.1 容器镜像

| 服务名称 | 镜像名称 | 镜像版本 | 镜像仓库 |
|---------|---------|---------|---------|
| [服务名称] | [镜像名称] | [版本] | [仓库地址] |

### 5.2 容器编排

**编排工具**: [Docker Compose/Kubernetes/其他]

**配置文件**:
```yaml
[容器编排配置]
```

### 5.3 资源配置

| 服务名称 | CPU | 内存 | 磁盘 | 副本数 |
|---------|-----|------|------|--------|
| [服务名称] | [CPU] | [内存] | [磁盘] | [副本数] |

### 5.4 健康检查

| 服务名称 | 检查方式 | 检查路径 | 检查间隔 | 超时时间 |
|---------|---------|---------|---------|---------|
| [服务名称] | [方式] | [路径] | [间隔] | [超时] |

---

## 6. CI/CD流程

### 6.1 CI流程

```
[代码提交] → [代码检查] → [单元测试] → [构建镜像] → [推送镜像]
```

**流程说明**:
1. **代码检查**: [工具和规则]
2. **单元测试**: [测试命令]
3. **构建镜像**: [构建命令]
4. **推送镜像**: [推送命令]

### 6.2 CD流程

```
[拉取镜像] → [停止旧服务] → [启动新服务] → [健康检查] → [切换流量]
```

**流程说明**:
1. **拉取镜像**: [拉取命令]
2. **停止旧服务**: [停止命令]
3. **启动新服务**: [启动命令]
4. **健康检查**: [检查命令]
5. **切换流量**: [切换命令]

### 6.3 自动化脚本

**部署脚本**:
```bash
[部署脚本内容]
```

**回滚脚本**:
```bash
[回滚脚本内容]
```

---

## 7. 发布策略

### 7.1 发布方式

- **发布方式**: [蓝绿部署/滚动发布/金丝雀发布]
- **选择理由**: [说明]

### 7.2 灰度发布

**灰度策略**:
- **灰度比例**: [比例]
- **灰度时长**: [时长]
- **灰度用户**: [用户群体]

**灰度流程**:
```
[灰度发布流程图]
```

### 7.3 发布检查清单

- [ ] 代码已合并到主分支
- [ ] 单元测试已通过
- [ ] 集成测试已通过
- [ ] 性能测试已通过
- [ ] 安全测试已通过
- [ ] 数据库迁移脚本已准备
- [ ] 配置文件已更新
- [ ] 监控告警已配置
- [ ] 回滚方案已准备
- [ ] 相关人员已通知

---

## 8. 数据库部署

### 8.1 数据库迁移

**迁移脚本**:
```sql
[数据库迁移脚本]
```

**迁移步骤**:
1. [步骤1]
2. [步骤2]
3. [步骤3]

### 8.2 数据备份

- **备份时间**: {YYYY-MM-DD HH:mm:ss}
- **备份方式**: [方式]
- **备份位置**: [位置]
- **备份验证**: [验证方法]

### 8.3 数据回滚

**回滚脚本**:
```sql
[数据库回滚脚本]
```

---

## 9. 回滚方案

### 9.1 回滚触发条件

- [条件1]
- [条件2]
- [条件3]

### 9.2 回滚步骤

1. **停止新版本服务**: [命令]
2. **恢复旧版本服务**: [命令]
3. **切换流量**: [命令]
4. **验证服务**: [验证方法]
5. **回滚数据库**: [命令]

### 9.3 回滚时间

- **预计回滚时间**: [时长]
- **回滚窗口**: [时间段]

---

## 10. 监控告警

### 10.1 监控指标

| 指标类型 | 指标名称 | 阈值 | 告警级别 |
|---------|---------|------|---------|
| [类型] | [指标] | [阈值] | [级别] |

### 10.2 告警配置

| 告警名称 | 告警条件 | 告警级别 | 通知方式 | 接收人 |
|---------|---------|---------|---------|--------|
| [名称] | [条件] | [级别] | [方式] | [姓名] |

### 10.3 日志收集

- **日志级别**: [级别]
- **日志存储**: [存储位置]
- **日志保留**: [保留时长]

---

## 11. 应急预案

### 11.1 故障场景

#### 场景1: [故障场景]

**故障描述**: [描述]

**影响范围**: [范围]

**应对措施**:
1. [措施1]
2. [措施2]
3. [措施3]

**负责人**: [姓名]

#### 场景2: [故障场景]

[按照相同结构描述]

### 11.2 应急联系人

| 角色 | 姓名 | 电话 | 邮箱 | 职责 |
|------|------|------|------|------|
| [角色] | [姓名] | [电话] | [邮箱] | [职责] |

---

## 12. 部署验证

### 12.1 验证清单

- [ ] 服务启动正常
- [ ] 健康检查通过
- [ ] 接口响应正常
- [ ] 数据库连接正常
- [ ] 缓存连接正常
- [ ] 消息队列连接正常
- [ ] 日志输出正常
- [ ] 监控数据正常
- [ ] 核心功能验证通过
- [ ] 性能指标达标

### 12.2 验证脚本

```bash
[验证脚本内容]
```

### 12.3 验证报告

**验证时间**: {YYYY-MM-DD HH:mm:ss}

**验证结果**:
| 验证项 | 预期结果 | 实际结果 | 状态 |
|--------|---------|---------|------|
| [验证项] | [预期] | [实际] | [Pass/Fail] |

---

## 13. 部署时间表

| 时间 | 任务 | 负责人 | 状态 |
|------|------|--------|------|
| {HH:mm} | [任务] | [姓名] | [待执行/执行中/已完成] |

---

## 14. 风险评估

| 风险 | 影响程度 | 发生概率 | 应对措施 | 负责人 |
|------|---------|---------|---------|--------|
| [风险] | [高/中/低] | [高/中/低] | [措施] | [姓名] |

---

## 合规自检

- [ ] 部署目标明确
- [ ] 环境配置完整
- [ ] 部署架构清晰
- [ ] 容器化方案可行
- [ ] CI/CD流程完整
- [ ] 发布策略合理
- [ ] 回滚方案完善
- [ ] 监控告警配置完整
- [ ] 应急预案充分
- [ ] 部署验证清单完整
- [ ] 包含必要的元信息

---

**文档生成完成，版本号：v{YYYYMMDDHHmmss}**
```

---

## 使用说明

### 何时使用？

- 测试完成准备上线时
- 需要制定部署方案时
- 需要规范部署流程时

### 填写要点

1. **环境配置清晰**: 各环境配置要清晰明确
2. **流程完整**: 部署流程要完整可执行
3. **回滚方案**: 必须有完善的回滚方案
4. **监控告警**: 监控告警配置要完整
5. **应急预案**: 应急预案要充分

### 后续流程

1. 基于本方案执行部署
2. 记录部署过程
3. 产出部署报告
4. 进入运维阶段

---

## 相关模板

- **上一步**: [测试报告模板](./test-report.md)
- **下一步**: [运维手册模板](./ops-manual.md)
- **参考**: [战略设计文档模板](../strategy-design/strategy-doc.md)
