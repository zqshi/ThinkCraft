<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ThinkCraft - AI思维助手</title>

    <!-- PWA配置 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ThinkCraft">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192.png">

    <!-- SEO优化 -->
    <meta name="description" content="快速捕捉灵感，通过苏格拉底式提问深化思维，AI辅助生成商业计划书">
    <meta name="keywords" content="AI助手,思维工具,灵感记录,商业计划,创意分析">

    <link rel="stylesheet" href="frontend/css/inline.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="frontend/js/core/device-detector.js"></script>
    <script src="frontend/js/core/gesture-handler.js"></script>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">ThinkCraft</div>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                    </svg>
                    新建对话
                </button>
            </div>

            <!-- Sidebar切换Tab -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="chats" onclick="switchSidebarTab('chats')">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    <span>对话</span>
                </button>
                <button class="sidebar-tab" data-tab="team" onclick="switchSidebarTab('team')" id="teamTab" style="display: none;">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    <span>团队</span>
                </button>
            </div>

            <!-- 对话列表视图 -->
            <div class="sidebar-view" id="chatsView">
                <div class="chat-history" id="chatHistory"></div>
            </div>

            <!-- 团队空间视图 -->
            <div class="sidebar-view" id="teamView" style="display: none;">
                <!-- 动态渲染，初始为空 -->
            </div>

            <!-- Sidebar底部：用户信息区 -->
            <div class="sidebar-footer">
                <div class="user-info" onclick="openBottomSettings()">
                    <div class="user-avatar">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                            <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                        </svg>
                    </div>
                    <div class="user-name" id="userName">ThinkCraft 用户</div>
                    <button class="settings-icon" onclick="event.stopPropagation(); openBottomSettings()" aria-label="设置">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <!-- 移动端：左侧汉堡菜单 -->
                <button class="menu-toggle" onclick="toggleSidebar()" aria-label="打开菜单">
                    <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>

                <div class="main-title" id="mainTitle">ThinkCraft AI</div>

                <div class="header-actions">
                    <!-- 移动端：新建对话按钮 -->
                    <button class="mobile-new-chat-btn" onclick="startNewChat()" title="新建对话" aria-label="新建对话">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                    </button>
                    <!-- 桌面端：设置按钮 -->
                    <button class="icon-btn desktop-only" onclick="showSettings()" title="设置">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="chat-container" id="chatContainer">
                <div class="empty-state" id="emptyState">
                    <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    <div class="empty-title">苏格拉底式思维引导</div>
                    <div class="empty-subtitle">通过深度提问，帮助你理清创意思路、发现盲点、形成结构化洞察</div>
                    <!-- 快速开始卡片已隐藏 -->
                </div>
                <div id="messageList" style="display: none;"></div>
            </div>

            <!-- 知识库面板（右侧切换面板）-->
            <div class="knowledge-panel" id="knowledgePanel" style="display: none;">
                <div class="knowledge-panel-content">
                    <!-- 左侧：组织树 -->
                    <div class="knowledge-sidebar">
                        <div class="knowledge-org-switcher">
                            <button class="active" data-org="byProject" onclick="switchKnowledgeOrg('byProject')">按项目</button>
                            <button data-org="byType" onclick="switchKnowledgeOrg('byType')">按类型</button>
                            <button data-org="byTimeline" onclick="switchKnowledgeOrg('byTimeline')">时间线</button>
                            <button data-org="byTags" onclick="switchKnowledgeOrg('byTags')">标签</button>
                        </div>
                        <div id="knowledgeOrgTree" class="knowledge-org-tree"></div>
                    </div>

                    <!-- 右侧：知识列表 -->
                    <div class="knowledge-main">
                        <div class="knowledge-toolbar">
                            <input type="text" id="knowledgeSearch" placeholder="搜索知识..." oninput="onKnowledgeSearch(this.value)">
                            <select id="knowledgeTypeFilter" onchange="onKnowledgeTypeFilter(this.value)">
                                <option value="">所有类型</option>
                                <option value="prd">PRD</option>
                                <option value="tech">技术方案</option>
                                <option value="analysis">市场分析</option>
                                <option value="research">调研报告</option>
                                <option value="design">设计文档</option>
                                <option value="other">其他</option>
                            </select>
                            <button class="btn-primary" onclick="createKnowledge()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                新建
                            </button>
                        </div>
                        <div id="knowledgeList" class="knowledge-grid"></div>
                        <div id="knowledgeEmpty" class="empty-state" style="display: none;">
                            <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                            <div class="empty-title">暂无知识沉淀</div>
                            <div class="empty-subtitle">创建第一个知识条目</div>
                            <button class="btn-primary" onclick="createKnowledge()" style="margin-top: 16px;">新建知识</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container" id="inputContainer">
                <div class="input-wrapper">
                    <!-- 移动端：语音模式（默认） -->
                    <div class="mobile-voice-mode" id="mobileVoiceMode">
                        <button class="mobile-tool-btn" onclick="handleCamera()" title="拍照" aria-label="拍照">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>

                        <button class="mobile-voice-btn" id="mobileVoiceBtn">
                            <svg width="22" height="22" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                            </svg>
                            <span>按住说话</span>
                        </button>

                        <button class="mobile-tool-btn" onclick="handleImageUpload()" title="图片" aria-label="上传图片">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </button>

                        <button class="mobile-tool-btn" onclick="switchToTextMode()" title="切换文字输入" aria-label="切换文字输入">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- 移动端：文本模式 -->
                    <div class="mobile-text-mode" id="mobileTextMode" style="display: none;">
                        <button class="mobile-tool-btn-small" onclick="switchToVoiceMode()" title="切换语音输入" aria-label="切换语音输入">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                            </svg>
                        </button>
                        <button class="mobile-tool-btn-small" onclick="handleCamera()" title="拍照" aria-label="拍照">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                        <button class="mobile-tool-btn-small" onclick="handleImageUpload()" title="图片" aria-label="上传图片">
                            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </button>
                        <textarea
                            class="mobile-text-input"
                            id="mobileTextInput"
                            placeholder="输入消息..."
                            rows="1"
                            onkeydown="handleKeyDown(event)"
                            oninput="autoResize(this)"
                        ></textarea>
                        <button class="mobile-send-btn" onclick="sendMessage()">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                        </button>
                    </div>

                    <!-- 桌面端：文本模式（默认） -->
                    <div class="desktop-text-mode" id="desktopTextMode">
                        <div class="desktop-input-tools">
                            <button class="desktop-tool-btn" onclick="switchDesktopToVoice()" title="切换语音输入" aria-label="切换语音输入">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                                </svg>
                            </button>
                            <button class="desktop-tool-btn" onclick="handleImageUpload()" title="上传图片" aria-label="上传图片">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="desktop-input-box">
                            <textarea
                                class="desktop-text-input"
                                id="mainInput"
                                placeholder="分享你的创意想法，让我们通过深度对话来探索它的可能性..."
                                rows="1"
                                onkeydown="handleKeyDown(event)"
                                onkeyup="handleKeyUp(event)"
                                oninput="autoResize(this)"
                            ></textarea>
                            <button class="desktop-send-btn" id="sendBtn" onclick="sendMessage()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- 桌面端：语音模式 -->
                    <div class="desktop-voice-mode" id="desktopVoiceMode" style="display: none;">
                        <div class="desktop-input-tools">
                            <button class="desktop-tool-btn" onclick="switchDesktopToText()" title="切换文字输入" aria-label="切换文字输入">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button class="desktop-tool-btn" onclick="handleImageUpload()" title="上传图片" aria-label="上传图片">
                                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="desktop-input-box">
                            <button class="desktop-voice-btn" id="desktopVoiceBtn" onclick="handleVoice()">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                                </svg>
                                <span id="desktopVoiceText">点击语音输入</span>
                            </button>
                            <button class="desktop-send-btn" id="sendBtn2" onclick="sendMessage()" style="display: none;">
                                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            </div>
        </main>
    </div>

    <!-- 详细报告模态框 -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <div class="modal-title">创意思维结构化分析报告</div>
                    <button class="btn-secondary" onclick="regenerateInsightsReport()" style="padding: 6px 12px; font-size: 13px;">
                        🔄 重新生成
                    </button>
                </div>
                <button class="close-btn" onclick="closeReport()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body" id="reportContent">
                <!-- 报告内容将动态插入 -->
            </div>

            <div class="modal-footer">
                <!-- 深度分析按钮组 -->
                <div style="display: flex; gap: 12px; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border);">
                    <button
                        id="businessPlanBtn"
                        class="btn-primary generation-btn btn-idle"
                        data-type="business"
                        data-status="idle"
                        onclick="handleGenerationBtnClick('business')"
                        style="flex: 1;">
                        <span class="btn-icon">📊</span>
                        <span class="btn-text">商业计划书</span>
                    </button>
                    <button
                        id="proposalBtn"
                        class="btn-primary generation-btn btn-idle"
                        data-type="proposal"
                        data-status="idle"
                        onclick="handleGenerationBtnClick('proposal')"
                        style="flex: 1;">
                        <span class="btn-icon">📋</span>
                        <span class="btn-text">产品立项材料</span>
                    </button>
                </div>

                <!-- 第二阶段：交互Demo生成入口 -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="color: white; font-weight: 600; font-size: 16px; margin-bottom: 4px;">
                                🚀 第二阶段：验证与快速原型
                            </div>
                            <div style="color: rgba(255,255,255,0.9); font-size: 14px;">
                                基于您的创意，让AI快速生成可交互的产品Demo
                            </div>
                        </div>
                        <button
                            id="demoBtn"
                            class="btn-primary generation-btn btn-idle"
                            data-type="demo"
                            data-status="idle"
                            onclick="handleGenerationBtnClick('demo')"
                            style="background: white; color: #667eea; border: none; font-weight: 600;">
                            <span class="btn-icon">🚀</span>
                            <span class="btn-text">开始生成Demo</span>
                        </button>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn-secondary" onclick="exportFullReport()">导出PDF</button>
                    <button class="btn-primary" onclick="generateShareLink()">分享链接</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 分享卡片模态框 -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">创意分享</div>
                <button class="close-btn" onclick="closeShareModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <div class="share-card-container">
                    <div class="share-card" id="shareCard">
                        <div class="share-card-header">
                            <div class="share-card-logo">ThinkCraft</div>
                            <div class="share-card-badge">AI 分析</div>
                        </div>
                        <div class="share-card-main">
                            <div class="share-card-label">我的创意</div>
                            <div class="share-card-idea" id="shareIdeaTitle">创意验证工具</div>
                            <div class="share-card-tags">
                                <div class="share-tag" id="shareTag1">创业想法</div>
                                <div class="share-tag" id="shareTag2">AI工具</div>
                            </div>
                        </div>
                        <div class="share-card-stats">
                            <div class="share-stat">
                                <div>
                                    <div class="share-stat-value">85</div>
                                    <div class="share-stat-label">可行性</div>
                                </div>
                            </div>
                            <div class="share-stat">
                                <div>
                                    <div class="share-stat-value">78</div>
                                    <div class="share-stat-label">创新性</div>
                                </div>
                            </div>
                            <div class="share-stat">
                                <div>
                                    <div class="share-stat-value">92</div>
                                    <div class="share-stat-label">市场潜力</div>
                                </div>
                            </div>
                        </div>
                        <div class="share-card-footer">
                            <div class="share-card-footer-text">
                                <div class="share-card-footer-label">生成时间</div>
                                <div class="share-cta" id="shareDate">2026-01-09</div>
                            </div>
                            <div class="share-qr"></div>
                        </div>
                    </div>
                    <div class="share-actions">
                        <button class="share-action-btn secondary" onclick="downloadCard()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            下载图片
                        </button>
                        <button class="share-action-btn primary" onclick="copyShareText()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            复制文案
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 章节选择模态框 -->
    <div class="modal" id="chapterSelectionModal">
        <div class="modal-content chapter-selection">
            <div class="modal-header">
                <div class="modal-title">选择需要生成的章节</div>
                <button class="close-btn" onclick="closeChapterSelection()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <p class="tip">核心章节将自动生成，您可以选择需要深入分析的其他章节</p>

                <div id="chapterList">
                    <!-- 章节列表将通过JavaScript动态生成 -->
                </div>

                <div class="modal-footer" style="margin-top: 24px; padding-top: 20px; border-top: 2px solid var(--border);">
                    <p id="chapterStats" style="color: var(--text-secondary); font-size: 14px;">
                        已选 <strong style="color: var(--primary);">5</strong> 个章节，预计用时 <strong style="color: var(--primary);">2分钟</strong>
                    </p>
                    <button class="btn-primary" onclick="startGeneration()" style="margin-top: 12px;">开始生成</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent进度展示模态框 -->
    <div class="modal" id="agentProgressModal">
        <div class="modal-content agent-progress">
            <div class="modal-header">
                <div class="modal-title">🤖 AI专家团队正在工作中...</div>
            </div>

            <div class="modal-body">
                <!-- 整体进度 -->
                <div class="overall-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                    </div>
                    <p id="progressText">准备开始生成...</p>
                </div>

                <!-- Agent工作列表 -->
                <div class="agent-list" id="agentList">
                    <!-- Agent项目将通过JavaScript动态生成 -->
                </div>

                <button class="btn-secondary" onclick="cancelGeneration()" style="width: 100%; margin-top: 16px;">取消生成</button>
            </div>
        </div>
    </div>

    <!-- 商业计划书/产品立项报告模态框 -->
    <div class="modal" id="businessReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <div class="modal-title" id="businessReportTitle">商业计划书</div>
                    <button class="btn-secondary" onclick="regenerateBusinessReport()" style="padding: 6px 12px; font-size: 13px;">
                        🔄 重新生成
                    </button>
                </div>
                <button class="close-btn" onclick="closeBusinessReport()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body" id="businessReportContent">
                <!-- 报告内容将动态插入 -->
            </div>

            <div class="modal-footer">
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button class="btn-secondary" onclick="adjustBusinessReportChapters()">调整章节</button>
                    <button class="btn-secondary" onclick="exportBusinessReport()">导出PDF</button>
                    <button class="btn-primary" onclick="shareBusinessReport()">分享报告</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo类型选择模态框 -->
    <div class="modal" id="demoTypeModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">选择Demo类型</div>
                <button class="close-btn" onclick="closeDemoTypeSelection()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <p class="tip">选择您想要生成的Demo类型，AI将根据您的创意生成可交互的产品原型</p>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 24px;">
                    <div class="demo-type-card" onclick="selectDemoType('web')">
                        <div class="demo-type-icon">🌐</div>
                        <div class="demo-type-title">网站应用</div>
                        <div class="demo-type-desc">响应式网站、落地页、SaaS平台等</div>
                        <div class="demo-type-badge">推荐</div>
                    </div>

                    <div class="demo-type-card" onclick="selectDemoType('app')">
                        <div class="demo-type-icon">📱</div>
                        <div class="demo-type-title">移动应用</div>
                        <div class="demo-type-desc">iOS/Android App原型，支持交互演示</div>
                    </div>

                    <div class="demo-type-card" onclick="selectDemoType('miniapp')">
                        <div class="demo-type-icon">🎯</div>
                        <div class="demo-type-title">小程序</div>
                        <div class="demo-type-desc">微信小程序、支付宝小程序等</div>
                    </div>

                    <div class="demo-type-card" onclick="selectDemoType('admin')">
                        <div class="demo-type-icon">💼</div>
                        <div class="demo-type-title">管理后台</div>
                        <div class="demo-type-desc">后台管理系统、数据面板等</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo功能确认模态框 -->
    <div class="modal" id="demoFeaturesModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">确认Demo功能</div>
                <button class="close-btn" onclick="closeDemoFeatures()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <p class="tip">AI已根据您的创意分析出以下核心功能，请确认或调整</p>

                <div id="demoFeaturesList" style="margin-top: 24px;">
                    <!-- 功能列表将通过JavaScript动态生成 -->
                </div>

                <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);">
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">
                        预计生成时间：<strong style="color: var(--primary);">3-5分钟</strong>
                    </p>
                    <button class="btn-primary" onclick="confirmDemoFeatures()" style="width: 100%;">
                        确认并开始生成
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo生成进度模态框 -->
    <div class="modal" id="demoProgressModal">
        <div class="modal-content agent-progress">
            <div class="modal-header">
                <div class="modal-title">🤖 AI开发团队正在生成Demo...</div>
            </div>

            <div class="modal-body">
                <!-- 整体进度 -->
                <div class="overall-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="demoProgressFill" style="width: 0%;"></div>
                    </div>
                    <p id="demoProgressText">准备开始生成...</p>
                </div>

                <!-- 详细步骤 -->
                <div class="demo-steps" id="demoStepsList">
                    <!-- 步骤列表将通过JavaScript动态生成 -->
                </div>

                <!-- 实时日志 -->
                <div style="margin-top: 20px;">
                    <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px;">
                        📋 实时日志
                    </div>
                    <div id="demoLogs" style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; line-height: 1.6; color: var(--text-secondary);">
                        <div>> 初始化开发环境...</div>
                    </div>
                </div>

                <button class="btn-secondary" onclick="cancelDemoGeneration()" style="width: 100%; margin-top: 16px;">取消生成</button>
            </div>
        </div>
    </div>

    <!-- Demo预览模态框 -->
    <div class="modal" id="demoPreviewModal">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh;">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <div class="modal-title">Demo预览</div>
                    <span class="badge" style="background: #10b981; color: white;">生成成功</span>
                </div>
                <button class="close-btn" onclick="closeDemoPreview()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Demo预览区域 -->
                <div style="border: 2px solid var(--border); border-radius: 12px; overflow: hidden; background: #f5f5f5;">
                    <div style="background: #e5e5e5; padding: 8px 16px; display: flex; align-items: center; gap: 8px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ff5f57;"></div>
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ffbd2e;"></div>
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #28ca42;"></div>
                        <div style="flex: 1; text-align: center; font-size: 12px; color: #666;">
                            demo-preview.html
                        </div>
                    </div>
                    <div id="demoPreviewFrame" style="background: white; height: 500px; display: flex; align-items: center; justify-content: center;">
                        <div style="text-align: center; color: var(--text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 16px;">🎉</div>
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Demo生成成功！</div>
                            <div style="font-size: 14px;">您的产品原型已准备就绪</div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
                    <button class="btn-secondary" onclick="downloadDemo()">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline; vertical-align: middle; margin-right: 4px;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        下载源代码
                    </button>
                    <button class="btn-secondary" onclick="viewDemoCode()">
                        📝 查看代码
                    </button>
                    <button class="btn-primary" onclick="shareDemoLink()">
                        🔗 分享Demo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 知识库模态框 -->
    <!-- 知识库Modal - 新版双栏布局 -->
    <div class="modal" id="knowledgeModal">
        <div class="modal-content knowledge-modal-wide">
            <!-- Header -->
            <div class="modal-header" style="border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                <div class="knowledge-breadcrumb" id="knowledgeBreadcrumb">
                    <span>📚 全局知识库</span>
                </div>
                <button class="close-btn" onclick="closeKnowledgeBase()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- 主体：双栏布局 -->
            <div style="display: flex; flex: 1; overflow: hidden;">
                <!-- 左侧边栏：组织树 -->
                <div class="knowledge-sidebar">
                    <!-- 组织方式切换器 -->
                    <div class="knowledge-org-switcher">
                        <button class="active" data-org="byProject" onclick="switchKnowledgeOrganization('byProject')">按项目</button>
                        <button data-org="byType" onclick="switchKnowledgeOrganization('byType')">按类型</button>
                        <button data-org="byTimeline" onclick="switchKnowledgeOrganization('byTimeline')">时间线</button>
                        <button data-org="byTags" onclick="switchKnowledgeOrganization('byTags')">标签</button>
                    </div>

                    <!-- 动态组织树 -->
                    <div id="knowledgeOrgTree" class="knowledge-org-tree">
                        <!-- 由JS动态渲染 -->
                    </div>
                </div>

                <!-- 右侧主内容区 -->
                <div class="knowledge-main">
                    <!-- 工具栏 -->
                    <div class="knowledge-toolbar">
                        <input type="text" id="knowledgeSearch" placeholder="搜索知识..." oninput="onKnowledgeSearch(this.value)">
                        <select id="knowledgeTypeFilter" onchange="onKnowledgeTypeFilter(this.value)">
                            <option value="">所有类型</option>
                            <option value="prd">PRD</option>
                            <option value="tech">技术方案</option>
                            <option value="analysis">市场分析</option>
                            <option value="research">用户调研</option>
                            <option value="design">设计稿</option>
                            <option value="other">其他</option>
                        </select>
                        <button class="btn-primary" onclick="createKnowledge()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            新建
                        </button>
                    </div>

                    <!-- 知识卡片列表 -->
                    <div id="knowledgeList" class="knowledge-grid">
                        <!-- 由JS动态渲染 -->
                    </div>

                    <!-- 空状态 -->
                    <div id="knowledgeEmpty" class="empty-state" style="display: none;">
                        <div class="empty-icon">📚</div>
                        <div class="empty-text">暂无知识沉淀</div>
                        <button class="btn-primary" onclick="createKnowledge()">创建第一个</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div class="modal-title">设置</div>
                <button class="close-btn" onclick="closeSettings()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <div class="settings-section">
                    <div class="settings-section-title">外观</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">暗色模式</div>
                            <div class="settings-item-desc">切换为深色主题</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">数据管理</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">保存历史记录</div>
                            <div class="settings-item-desc">自动保存对话到本地</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="saveHistoryToggle" checked onchange="toggleSaveHistory()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="danger-btn" onclick="clearAllHistory()">清除所有历史记录</button>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">功能</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">数字员工团队</div>
                            <div class="settings-item-desc">启用AI团队协作功能，可在侧边栏切换查看</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableTeamToggle" onchange="toggleTeamFeature()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">关于</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">ThinkCraft v2.0</div>
                            <div class="settings-item-desc">AI思维助手 · 将灵感转化为洞察</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部上滑设置面板（移动端专用） -->
    <div class="bottom-sheet" id="bottomSettingsSheet">
        <div class="bottom-sheet-overlay" onclick="closeBottomSettings()"></div>
        <div class="bottom-sheet-content">
            <!-- 拖动指示条 -->
            <div class="bottom-sheet-handle"></div>

            <!-- 设置内容 -->
            <div class="bottom-sheet-header">
                <h3>设置</h3>
                <button class="close-btn" onclick="closeBottomSettings()" aria-label="关闭">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="bottom-sheet-body">
                <!-- 用户信息 -->
                <div class="settings-section">
                    <div class="user-profile">
                        <div class="user-avatar-large">
                            <svg width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                            </svg>
                        </div>
                        <div class="user-profile-info">
                            <div class="user-profile-name">ThinkCraft 用户</div>
                            <div class="user-profile-desc">探索思维的边界</div>
                        </div>
                    </div>
                </div>

                <!-- 主题设置 -->
                <div class="settings-section">
                    <div class="settings-section-title">外观</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">深色模式</div>
                            <div class="settings-item-desc">切换为深色主题</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle2" onchange="toggleDarkMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- 数据管理 -->
                <div class="settings-section">
                    <div class="settings-section-title">数据管理</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">保存历史记录</div>
                            <div class="settings-item-desc">自动保存对话到本地</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="saveHistoryToggle2" checked onchange="toggleSaveHistory()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="danger-btn" onclick="clearAllHistory()">清除所有历史记录</button>
                    </div>
                </div>

                <!-- 功能 -->
                <div class="settings-section">
                    <div class="settings-section-title">功能</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">数字员工团队</div>
                            <div class="settings-item-desc">启用AI团队协作功能，可在侧边栏切换查看</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableTeamToggle2" onchange="toggleTeamFeature()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- 关于 -->
                <div class="settings-section">
                    <div class="settings-section-title">关于</div>
                    <div class="settings-item">
                        <div class="settings-item-info">
                            <div class="settings-item-title">ThinkCraft v2.0</div>
                            <div class="settings-item-desc">AI思维助手 · 将灵感转化为洞察</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 项目详情模态框 -->
    <div class="modal" id="projectModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title" id="projectModalTitle">项目详情</div>
                <button class="close-btn" onclick="closeProjectModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- 项目概览 -->
                <div class="project-overview" id="projectOverview">
                    <div class="overview-card">
                        <div class="overview-label">状态</div>
                        <div class="overview-value" id="projectStatus" style="font-size: 16px;">-</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-label">团队成员</div>
                        <div class="overview-value" id="projectMemberCount">0</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-label">创意数</div>
                        <div class="overview-value" id="projectIdeaCount">0</div>
                    </div>
                </div>

                <!-- 团队成员 -->
                <div class="project-section">
                    <div class="project-section-header">
                        <h3>👥 团队成员</h3>
                        <button class="btn-primary" onclick="showAddMember()" style="padding: 8px 16px; font-size: 14px;">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 4px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            添加成员
                        </button>
                    </div>
                    <div class="project-members-grid" id="projectMembersList"></div>
                </div>

                <!-- 关联创意 -->
                <div class="project-section">
                    <div class="project-section-header">
                        <h3>💡 关联创意</h3>
                    </div>
                    <div class="project-ideas-grid" id="projectIdeasList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加成员模态框（数字员工雇佣）-->
    <div class="modal" id="addMemberModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">添加团队成员</div>
                <button class="close-btn" onclick="closeAddMember()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Tab切换 -->
                <div class="report-tabs" style="margin-bottom: 24px;">
                    <button class="report-tab active" onclick="switchAddMemberTab('market')">雇佣市场</button>
                    <button class="report-tab" onclick="switchAddMemberTab('hired')">已雇佣</button>
                </div>

                <!-- 雇佣市场Tab -->
                <div id="addMemberMarketTab" class="add-member-tab-content">
                    <div style="text-align: center; padding: 16px; background: #eff6ff; border-radius: 8px; margin-bottom: 24px;">
                        <p style="font-size: 14px; color: #1e40af; margin: 0;">💼 选择数字员工加入项目团队，他们将为项目提供专业支持</p>
                    </div>
                    <!-- 员工列表 -->
                    <div class="agent-market-grid" id="projectAgentList"></div>
                </div>

                <!-- 已雇佣Tab -->
                <div id="addMemberHiredTab" class="add-member-tab-content" style="display: none;">
                    <div style="text-align: center; padding: 16px; background: #f0fdf4; border-radius: 8px; margin-bottom: 24px;">
                        <p style="font-size: 14px; color: #166534; margin: 0;">👥 当前项目已雇佣的数字员工，点击解雇可以移除成员</p>
                    </div>
                    <!-- 已雇佣员工列表 -->
                    <div class="agent-market-grid" id="projectHiredAgentList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 员工市场模态框 -->
    <div class="modal" id="agentMarketModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <div class="modal-title">🏪 数字员工市场</div>
                <button class="close-btn" onclick="closeAgentMarket()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Tab切换 -->
                <div class="report-tabs" style="margin-bottom: 24px;">
                    <button class="report-tab active" onclick="switchMarketTab('market')">可雇佣</button>
                    <button class="report-tab" onclick="switchMarketTab('hired')">已雇佣</button>
                </div>

                <!-- 可雇佣员工列表 -->
                <div id="marketTab" class="market-tab-content">
                    <div id="agentMarketGrid" class="agent-market-grid"></div>
                </div>

                <!-- 已雇佣员工列表 -->
                <div id="hiredTab" class="market-tab-content" style="display: none;">
                    <div id="hiredAgentsGrid" class="agent-market-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- 系统提示词配置 -->
    <script src="config/system-prompts.js"></script>
    <!-- Mock 数据（用于演示） -->
    <script src="config/mock-data.js"></script>

    <!-- 核心模块 -->
    <script src="frontend/js/core/state-manager.js"></script>
    <script src="frontend/js/core/api-client.js"></script>
    <script src="frontend/js/core/storage-manager.js"></script>

    <!-- 组件模块 -->
    <script src="frontend/js/components/modal-manager.js"></script>
    <script src="frontend/js/components/agent-progress.js"></script>

    <!-- 功能模块 -->
    <script src="frontend/js/modules/business-plan-generator.js"></script>

<script src="frontend/js/app-main.js"></script>
</body></html>
